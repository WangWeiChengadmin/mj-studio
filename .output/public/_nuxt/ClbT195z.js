import{C as x,f as U,R as V,g as q,q as R,m as C,c as i,o,a as e,b as a,i as F,h as S,j as r,w as v,d as k,k as O,t as b,F as j,r as A,z as G,y as z}from"./DZ_1_TWT.js";import{_ as H}from"./CHDMZO_x.js";import{_ as I}from"./GNaDb_Wx.js";import"./2BvrFYEm.js";import"./CHEUhdok.js";import"./DDAgXY8S.js";function J(){const p=x("trash-tasks",()=>[]),d=x("trash-loading",()=>!1),f=x("trash-page",()=>1),u=x("trash-pageSize",()=>20),m=x("trash-total",()=>0);async function g(c){d.value=!0,c!==void 0&&(f.value=c);try{const n=await $fetch("/api/tasks/trash",{query:{page:f.value,pageSize:u.value}});p.value=n.tasks,m.value=n.total}catch(n){console.error("加载回收站失败:",n)}finally{d.value=!1}}async function y(c){await $fetch(`/api/tasks/${c}/restore`,{method:"POST"}),p.value=p.value.filter(n=>n.id!==c),m.value=Math.max(0,m.value-1)}async function T(){const c=await $fetch("/api/tasks/trash/empty",{method:"DELETE"});return p.value=[],m.value=0,c.deleted}return{tasks:p,isLoading:d,currentPage:f,pageSize:u,total:m,loadTrash:g,restoreTask:y,emptyTrash:T}}const K={class:"space-y-4"},Q={class:"flex items-center justify-between"},W={class:"flex items-center gap-3"},X={class:"text-(--ui-text-dimmed) text-sm"},Y={key:0,class:"text-center py-12"},Z={key:1,class:"text-center py-12"},tt={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},et={class:"aspect-square rounded-lg overflow-hidden bg-(--ui-bg) mb-3"},st=["src"],ot={key:1,class:"w-full h-full flex flex-col items-center justify-center p-4 bg-error/5"},at={class:"text-xs text-error text-center line-clamp-3"},nt={key:2,class:"w-full h-full flex items-center justify-center"},rt={class:"space-y-2"},it={class:"text-(--ui-text) text-sm line-clamp-2"},lt={class:"flex items-center justify-between text-xs text-(--ui-text-dimmed)"},ct={key:0,class:"flex justify-center mt-6"},dt={class:"flex justify-end gap-3"},ut=U({__name:"Trash",setup(p){const{tasks:d,isLoading:f,currentPage:u,pageSize:m,total:g,loadTrash:y,restoreTask:T,emptyTrash:c}=J(),n=V(),L=q(()=>Math.ceil(g.value/m.value));R(()=>{y()});async function P(l){try{await T(l),n.add({title:"恢复成功",description:"任务已恢复到任务列表",color:"success"})}catch(t){n.add({title:"恢复失败",description:t.data?.message||t.message||"请稍后重试",color:"error"})}}const _=C(!1),$=C(!1);async function B(){$.value=!0;try{const l=await c();_.value=!1,n.add({title:"清空成功",description:`已永久删除 ${l} 个任务`,color:"success"})}catch(l){n.add({title:"清空失败",description:l.data?.message||l.message||"请稍后重试",color:"error"})}finally{$.value=!1}}function E(){y()}function N(l){return l?new Date(l).toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):""}return(l,t)=>{const h=O,w=G,D=H,M=I;return o(),i("div",K,[e("div",Q,[t[5]||(t[5]=e("h2",{class:"text-(--ui-text) text-lg font-medium"},"回收站",-1)),e("div",W,[r(d).length>0?(o(),F(w,{key:0,size:"xs",variant:"ghost",color:"error",onClick:t[0]||(t[0]=s=>_.value=!0)},{default:v(()=>[a(h,{name:"i-heroicons-trash",class:"w-4 h-4 mr-1"}),t[4]||(t[4]=k(" 清空回收站 ",-1))]),_:1})):S("",!0),e("span",X,"共 "+b(r(g))+" 个任务",1)])]),r(f)?(o(),i("div",Y,[a(h,{name:"i-heroicons-arrow-path",class:"w-8 h-8 text-(--ui-text-dimmed) mx-auto mb-2 animate-spin"}),t[6]||(t[6]=e("p",{class:"text-(--ui-text-dimmed)"},"加载中...",-1))])):r(d).length===0?(o(),i("div",Z,[a(h,{name:"i-heroicons-trash",class:"w-16 h-16 text-(--ui-text-dimmed)/50 mx-auto mb-4"}),t[7]||(t[7]=e("p",{class:"text-(--ui-text-dimmed)"},"回收站是空的",-1)),t[8]||(t[8]=e("p",{class:"text-(--ui-text-dimmed)/70 text-sm mt-1"},"删除的任务会出现在这里",-1))])):(o(),i(j,{key:2},[e("div",tt,[(o(!0),i(j,null,A(r(d),s=>(o(),i("div",{key:s.id,class:"bg-(--ui-bg-elevated) rounded-lg p-4 border border-(--ui-border)"},[e("div",et,[s.resourceUrl?(o(),i("img",{key:0,src:s.resourceUrl,alt:"生成的图片",class:"w-full h-full object-cover"},null,8,st)):s.status==="failed"?(o(),i("div",ot,[a(h,{name:"i-heroicons-exclamation-circle",class:"w-10 h-10 text-error mb-2"}),e("p",at,b(s.error||"生成失败"),1)])):(o(),i("div",nt,[a(h,{name:"i-heroicons-photo",class:"w-12 h-12 text-(--ui-text-dimmed)/30"})]))]),e("div",rt,[e("p",it,b(s.prompt||"(无提示词)"),1),e("div",lt,[e("span",null,"删除于 "+b(N(s.deletedAt)),1),a(w,{size:"xs",variant:"soft",color:"primary",onClick:_t=>P(s.id)},{default:v(()=>[a(h,{name:"i-heroicons-arrow-uturn-left",class:"w-3.5 h-3.5 mr-1"}),t[9]||(t[9]=k(" 恢复 ",-1))]),_:1},8,["onClick"])])])]))),128))]),r(L)>1?(o(),i("div",ct,[a(D,{page:r(u),"onUpdate:page":[t[1]||(t[1]=s=>z(u)?u.value=s:null),E],total:r(g),"items-per-page":r(m)},null,8,["page","total","items-per-page"])])):S("",!0)],64)),a(M,{open:r(_),"onUpdate:open":t[3]||(t[3]=s=>z(_)?_.value=s:null),title:"清空回收站",description:"此操作将永久删除回收站中的所有任务，无法恢复。确定要继续吗？"},{footer:v(()=>[e("div",dt,[a(w,{variant:"ghost",color:"neutral",onClick:t[2]||(t[2]=s=>_.value=!1)},{default:v(()=>[...t[10]||(t[10]=[k("取消",-1)])]),_:1}),a(w,{color:"error",loading:r($),onClick:B},{default:v(()=>[...t[11]||(t[11]=[k("确认清空",-1)])]),_:1},8,["loading"])])]),_:1},8,["open"])])}}}),mt=Object.assign(ut,{__name:"StudioTrash"}),pt={class:"p-6"},ft={class:"max-w-7xl mx-auto"},kt=U({__name:"trash",setup(p){return(d,f)=>{const u=mt;return o(),i("div",pt,[e("div",ft,[a(u)])])}}});export{kt as default};
