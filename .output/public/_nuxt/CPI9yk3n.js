import{f as Y,S as q,m as f,p as b,g as h,c as i,o as r,b as g,d as H,k as G,t as x,a as u,j as l,n as y,af as J,w as K,h as S,F as D,r as R,v as Q}from"./DZ_1_TWT.js";import{o as X}from"./DDAgXY8S.js";import{o as $,p as Z}from"./Cl2C_jUo.js";const ee={key:0,class:"text-xs text-(--ui-text-muted) flex items-center"},te=["disabled"],oe={class:"flex items-center gap-2"},se={class:"text-(--ui-text)"},ae={key:0,class:"border-t border-(--ui-border)"},ne={class:"flex items-center justify-between px-3 py-2 bg-(--ui-bg-muted)"},ie={class:"text-xs font-medium text-(--ui-text-muted)"},re=["onClick"],le=["onClick"],de={class:"truncate"},ce=Y({__name:"ModelSelector",props:{upstreams:{},category:{},upstreamId:{},aimodelId:{},showTypeLabel:{type:Boolean},dropdownWidth:{},listLayout:{type:Boolean},noAutoSelect:{type:Boolean},alignRight:{type:Boolean}},emits:["update:upstreamId","update:aimodelId"],setup(d,{expose:A,emit:E}){const s=d,_=E,O=q(),m=f(!1),T=f(),w=f(),C=f(!1),c=f(s.upstreamId??null),n=f(s.aimodelId??null);b(()=>s.upstreamId,e=>{c.value=e??null}),b(()=>s.aimodelId,e=>{n.value=e??null}),X(T,()=>{m.value=!1});function j(){if(!w.value)return;const e=w.value.getBoundingClientRect(),t=window.innerHeight-e.bottom,o=e.top;C.value=t<320&&o>t}function U(){m.value||j(),m.value=!m.value}function B(e){return["midjourney","gemini","flux","dalle","doubao","gpt4o-image","grok-image","qwen-image","z-image"].includes(e)}function k(e){return e.filter(t=>s.category==="image"?t.category==="image"||!t.category&&B(t.modelType):s.category==="video"?t.category==="video":t.category==="chat"||!t.category&&t.apiFormat==="openai-chat"&&!B(t.modelType))}const L=h(()=>{const e=[];for(const t of s.upstreams){const o=k(t.aimodels||[]);o.length>0&&e.push({upstreamId:t.id,upstreamName:t.name,aimodels:o})}return e}),I=h(()=>L.value.some(e=>e.aimodels.length>0)),M=h(()=>s.upstreams.find(e=>e.id===c.value)),V=h(()=>{if(!(!M.value||!n.value))return M.value.aimodels?.find(e=>e.id===n.value)}),z=h(()=>{if(!c.value||!n.value)return"选择模型";const e=s.upstreams.find(a=>a.id===c.value);if(!e)return"选择模型";const t=e.aimodels?.find(a=>a.id===n.value);if(!t)return`${e.name} / 未知模型`;const o=s.showTypeLabel?$[t.modelType]||t.modelType:t.modelName;return`${e.name} / ${o}`});function F(e){return Z[e]||"i-heroicons-sparkles"}function P(e){return s.showTypeLabel?$[e.modelType]||e.modelType:e.modelName}function W(e,t){return c.value===e&&n.value===t}function N(e,t){c.value=e,n.value=t,_("update:upstreamId",e),_("update:aimodelId",t),m.value=!1}return b(()=>s.upstreams,e=>{if(!s.noAutoSelect&&e.length>0&&!c.value){const t=e[0],o=k(t.aimodels||[]);o.length>0&&N(t.id,o[0].id)}},{immediate:!0}),b(c,e=>{if(!e)return;const t=s.upstreams.find(v=>v.id===e);if(!t)return;const o=k(t.aimodels||[]),a=o.map(v=>v.id);(!n.value||!a.includes(n.value))&&o.length>0&&(n.value=o[0].id,_("update:aimodelId",n.value))}),A({selectedUpstream:M,selectedAimodel:V}),(e,t)=>{const o=G;return r(),i("div",{ref_key:"dropdownRef",ref:T,class:"relative"},[d.upstreams.length===0?(r(),i("div",ee,[g(o,{name:"i-heroicons-exclamation-circle",class:"w-4 h-4 mr-1"}),H(" 请先在设置中添加"+x(d.category==="chat"?"对话":d.category==="video"?"视频":"绘图")+"模型 ",1)])):(r(),i("div",{key:1,ref_key:"triggerRef",ref:w},[u("button",{type:"button",class:y(["flex items-center justify-between gap-2 w-full min-w-48 px-3 py-2 rounded-lg border border-(--ui-border) bg-(--ui-bg) hover:bg-(--ui-bg-elevated) transition-colors text-sm",{"opacity-50 cursor-not-allowed":!l(I)}]),disabled:!l(I),onClick:U},[u("span",oe,[g(o,{name:"i-heroicons-cpu-chip",class:"w-4 h-4 text-(--ui-text-muted)"}),u("span",se,x(l(z)),1)]),g(o,{name:"i-heroicons-chevron-down",class:y(["w-4 h-4 text-(--ui-text-muted) transition-transform",{"rotate-180":l(m)}])},null,8,["class"])],10,te)],512)),g(J,{"enter-active-class":"transition duration-100 ease-out","enter-from-class":"opacity-0 scale-95","enter-to-class":"opacity-100 scale-100","leave-active-class":"transition duration-75 ease-in","leave-from-class":"opacity-100 scale-100","leave-to-class":"opacity-0 scale-95"},{default:K(()=>[l(m)&&l(I)?(r(),i("div",{key:0,class:y(["absolute z-50 max-h-80 overflow-y-auto rounded-lg border border-(--ui-border) bg-(--ui-bg-elevated) shadow-lg",[l(C)?"bottom-full mb-1":"top-full mt-1",d.dropdownWidth||"w-80",d.alignRight?"right-0":"left-0"]])},[(r(!0),i(D,null,R(l(L),(a,v)=>(r(),i("div",{key:a.upstreamId},[v>0?(r(),i("div",ae)):S("",!0),u("div",ne,[u("span",ie,x(a.upstreamName),1),u("button",{class:"p-1 hover:bg-(--ui-bg-accented) rounded text-(--ui-text-muted) hover:text-(--ui-text)",onClick:Q(p=>l(O).push(`/settings/upstreams/${a.upstreamId}`),["stop"])},[g(o,{name:"i-heroicons-cog-6-tooth",class:"w-3.5 h-3.5"})],8,re)]),u("div",{class:y(d.listLayout?"flex flex-col gap-1 p-2":"grid grid-cols-2 gap-2 p-2")},[(r(!0),i(D,null,R(a.aimodels,p=>(r(),i("button",{key:p.id,class:y(["flex items-center gap-1.5 px-2 py-1.5 rounded-lg text-left text-sm transition-colors",[W(a.upstreamId,p.id)?"bg-(--ui-primary)/10 text-(--ui-primary)":"hover:bg-(--ui-bg-accented) text-(--ui-text)",d.listLayout?"":"border border-(--ui-border) hover:border-(--ui-primary)"]]),onClick:ue=>N(a.upstreamId,p.id)},[g(o,{name:F(p.modelType),class:"w-4 h-4 shrink-0"},null,8,["name"]),u("span",de,x(P(p)),1)],10,le))),128))],2)]))),128))],2)):S("",!0)]),_:1})],512)}}}),ge=Object.assign(ce,{__name:"ModelSelector"});export{ge as _};
