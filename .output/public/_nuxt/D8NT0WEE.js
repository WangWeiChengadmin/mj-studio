import{f as ce,W as Ze,X as Je,Y as Ye,Z as Me,i as j,o as a,w as p,N as xe,j as e,P as Te,m as k,g as T,p as he,I as St,q as Be,$ as Ut,b as l,a0 as Oe,h as v,a1 as Vt,H as Mt,v as Qe,a2 as Ve,a3 as Xe,a4 as je,J as et,a5 as At,a6 as tt,a7 as Rt,a8 as Dt,K as Ee,a as t,c as m,n as Q,k as be,F as ve,d as te,t as U,a9 as Et,R as $e,B as Bt,y as E,z as Ce,r as Ae,e as st,s as Pe,x as lt,_ as Ot,C as ye,l as jt}from"./DZ_1_TWT.js";import{_ as at}from"./CPI9yk3n.js";import{_ as ot}from"./BsBDnP6U.js";import{_ as Ie}from"./GNaDb_Wx.js";import{_ as nt}from"./DRejpVBE.js";import{_ as it,a as qt}from"./DWVrQyU4.js";import{_ as Fe}from"./BOxYQfEP.js";import{L as Pt}from"./uQ15kqef.js";import{u as Ft,V as Lt}from"./DASMixbo.js";import{u as zt}from"./CHEUhdok.js";import{A as Le,M as De,U as _e,c as Nt,d as Wt,e as Gt,f as Ht,g as Kt,h as Zt,i as Jt,j as Yt,k as Qt,l as Xt,m as rt,T as ze,n as es,D as ut,P as dt,a as ct}from"./Cl2C_jUo.js";import{u as mt}from"./BgmUBLD9.js";import{_ as Ne,a as pt,s as ft}from"./CWvOuK_U.js";import{_ as ts}from"./Ds9Pl6UP.js";import{_ as ss}from"./CHDMZO_x.js";import{u as ls}from"./CJsX1qrP.js";import"./DDAgXY8S.js";import"./2BvrFYEm.js";import"./D41R7u62.js";import"./9BQeByXX.js";import"./CiEDGshs.js";const[vt,as]=Ze("CollapsibleRoot");var os=ce({__name:"CollapsibleRoot",props:{defaultOpen:{type:Boolean,required:!1,default:!1},open:{type:Boolean,required:!1,default:void 0},disabled:{type:Boolean,required:!1},unmountOnHide:{type:Boolean,required:!1,default:!0},asChild:{type:Boolean,required:!1},as:{type:null,required:!1}},emits:["update:open"],setup(s,{expose:C,emit:o}){const h=s,_=Je(h,"open",o,{defaultValue:h.defaultOpen,passive:h.open===void 0}),{disabled:I,unmountOnHide:g}=Ye(h);return as({contentId:"",disabled:I,open:_,unmountOnHide:g,onOpenToggle:()=>{I.value||(_.value=!_.value)}}),C({open:_}),Me(),(r,c)=>(a(),j(e(Te),{as:r.as,"as-child":h.asChild,"data-state":e(_)?"open":"closed","data-disabled":e(I)?"":void 0},{default:p(()=>[xe(r.$slots,"default",{open:e(_)})]),_:3},8,["as","as-child","data-state","data-disabled"]))}}),ns=os,is=ce({inheritAttrs:!1,__name:"CollapsibleContent",props:{forceMount:{type:Boolean,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1}},emits:["contentFound"],setup(s,{emit:C}){const o=s,h=C,u=vt();u.contentId||=zt(void 0,"reka-collapsible-content");const _=k(),{forwardRef:I,currentElement:g}=Me(),r=k(0),c=k(0),y=T(()=>u.open.value),x=k(y.value),S=k();he(()=>[y.value,_.value?.present],async()=>{await St();const $=g.value;if(!$)return;S.value=S.value||{transitionDuration:$.style.transitionDuration,animationName:$.style.animationName},$.style.transitionDuration="0s",$.style.animationName="none";const q=$.getBoundingClientRect();c.value=q.height,r.value=q.width,x.value||($.style.transitionDuration=S.value.transitionDuration,$.style.animationName=S.value.animationName)},{immediate:!0});const D=T(()=>x.value&&u.open.value);return Be(()=>{requestAnimationFrame(()=>{x.value=!1})}),Ut(g,"beforematch",$=>{requestAnimationFrame(()=>{u.onOpenToggle(),h("contentFound")})}),($,q)=>(a(),j(e(Vt),{ref_key:"presentRef",ref:_,present:$.forceMount||e(u).open.value,"force-mount":!0},{default:p(({present:F})=>[l(e(Te),Oe($.$attrs,{id:e(u).contentId,ref:e(I),"as-child":o.asChild,as:$.as,hidden:F?void 0:e(u).unmountOnHide.value?"":"until-found","data-state":D.value?void 0:e(u).open.value?"open":"closed","data-disabled":e(u).disabled?.value?"":void 0,style:{"--reka-collapsible-content-height":`${c.value}px`,"--reka-collapsible-content-width":`${r.value}px`}}),{default:p(()=>[!e(u).unmountOnHide.value||F?xe($.$slots,"default",{key:0}):v("v-if",!0)]),_:2},1040,["id","as-child","as","hidden","data-state","data-disabled","style"])]),_:3},8,["present"]))}}),rs=is,us=ce({__name:"CollapsibleTrigger",props:{asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"button"}},setup(s){const C=s;Me();const o=vt();return(h,u)=>(a(),j(e(Te),{type:h.as==="button"?"button":void 0,as:h.as,"as-child":C.asChild,"aria-controls":e(o).contentId,"aria-expanded":e(o).open.value,"data-state":e(o).open.value?"open":"closed","data-disabled":e(o).disabled?.value?"":void 0,disabled:e(o).disabled?.value,onClick:e(o).onOpenToggle},{default:p(()=>[xe(h.$slots,"default")]),_:3},8,["type","as","as-child","aria-controls","aria-expanded","data-state","data-disabled","disabled","onClick"]))}}),ds=us;const[cs,ms]=Ze("SwitchRoot");var ps=ce({__name:"SwitchRoot",props:{defaultValue:{type:Boolean,required:!1},modelValue:{type:[Boolean,null],required:!1,default:void 0},disabled:{type:Boolean,required:!1},id:{type:String,required:!1},value:{type:String,required:!1,default:"on"},asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"button"},name:{type:String,required:!1},required:{type:Boolean,required:!1}},emits:["update:modelValue"],setup(s,{emit:C}){const o=s,h=C,{disabled:u}=Ye(o),_=Je(o,"modelValue",h,{defaultValue:o.defaultValue,passive:o.modelValue===void 0});function I(){u.value||(_.value=!_.value)}const{forwardRef:g,currentElement:r}=Me(),c=Ft(r),y=T(()=>o.id&&r.value?document.querySelector(`[for="${o.id}"]`)?.innerText:void 0);return ms({modelValue:_,toggleCheck:I,disabled:u}),(x,S)=>(a(),j(e(Te),Oe(x.$attrs,{id:x.id,ref:e(g),role:"switch",type:x.as==="button"?"button":void 0,value:x.value,"aria-label":x.$attrs["aria-label"]||y.value,"aria-checked":e(_),"aria-required":x.required,"data-state":e(_)?"checked":"unchecked","data-disabled":e(u)?"":void 0,"as-child":x.asChild,as:x.as,disabled:e(u),onClick:I,onKeydown:Mt(Qe(I,["prevent"]),["enter"])}),{default:p(()=>[xe(x.$slots,"default",{modelValue:e(_)}),e(c)&&x.name?(a(),j(e(Lt),{key:0,type:"checkbox",name:x.name,disabled:e(u),required:x.required,value:x.value,checked:!!e(_)},null,8,["name","disabled","required","value","checked"])):v("v-if",!0)]),_:3},16,["id","type","value","aria-label","aria-checked","aria-required","data-state","data-disabled","as-child","as","disabled","onKeydown"]))}}),fs=ps,vs=ce({__name:"SwitchThumb",props:{asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"span"}},setup(s){const C=cs();return Me(),(o,h)=>(a(),j(e(Te),{"data-state":e(C).modelValue?.value?"checked":"unchecked","data-disabled":e(C).disabled.value?"":void 0,"as-child":o.asChild,as:o.as},{default:p(()=>[xe(o.$slots,"default")]),_:3},8,["data-state","data-disabled","as-child","as"]))}}),bs=vs;const xs={slots:{root:"relative flex items-start",base:["inline-flex items-center shrink-0 rounded-full border-2 border-transparent focus-visible:outline-2 focus-visible:outline-offset-2 data-[state=unchecked]:bg-accented","transition-[background] duration-200"],container:"flex items-center",thumb:"group pointer-events-none rounded-full bg-default shadow-lg ring-0 transition-transform duration-200 data-[state=unchecked]:translate-x-0 data-[state=unchecked]:rtl:-translate-x-0 flex items-center justify-center",icon:["absolute shrink-0 group-data-[state=unchecked]:text-dimmed opacity-0 size-10/12","transition-[color,opacity] duration-200"],wrapper:"ms-2",label:"block font-medium text-default",description:"text-muted"},variants:{color:{primary:{base:"data-[state=checked]:bg-primary focus-visible:outline-primary",icon:"group-data-[state=checked]:text-primary"},secondary:{base:"data-[state=checked]:bg-secondary focus-visible:outline-secondary",icon:"group-data-[state=checked]:text-secondary"},success:{base:"data-[state=checked]:bg-success focus-visible:outline-success",icon:"group-data-[state=checked]:text-success"},info:{base:"data-[state=checked]:bg-info focus-visible:outline-info",icon:"group-data-[state=checked]:text-info"},warning:{base:"data-[state=checked]:bg-warning focus-visible:outline-warning",icon:"group-data-[state=checked]:text-warning"},error:{base:"data-[state=checked]:bg-error focus-visible:outline-error",icon:"group-data-[state=checked]:text-error"},neutral:{base:"data-[state=checked]:bg-inverted focus-visible:outline-inverted",icon:"group-data-[state=checked]:text-highlighted"}},size:{xs:{base:"w-7",container:"h-4",thumb:"size-3 data-[state=checked]:translate-x-3 data-[state=checked]:rtl:-translate-x-3",wrapper:"text-xs"},sm:{base:"w-8",container:"h-4",thumb:"size-3.5 data-[state=checked]:translate-x-3.5 data-[state=checked]:rtl:-translate-x-3.5",wrapper:"text-xs"},md:{base:"w-9",container:"h-5",thumb:"size-4 data-[state=checked]:translate-x-4 data-[state=checked]:rtl:-translate-x-4",wrapper:"text-sm"},lg:{base:"w-10",container:"h-5",thumb:"size-4.5 data-[state=checked]:translate-x-4.5 data-[state=checked]:rtl:-translate-x-4.5",wrapper:"text-sm"},xl:{base:"w-11",container:"h-6",thumb:"size-5 data-[state=checked]:translate-x-5 data-[state=checked]:rtl:-translate-x-5",wrapper:"text-base"}},checked:{true:{icon:"group-data-[state=checked]:opacity-100"}},unchecked:{true:{icon:"group-data-[state=unchecked]:opacity-100"}},loading:{true:{icon:"animate-spin"}},required:{true:{label:"after:content-['*'] after:ms-0.5 after:text-error"}},disabled:{true:{root:"opacity-75",base:"cursor-not-allowed",label:"cursor-not-allowed",description:"cursor-not-allowed"}}},defaultVariants:{color:"primary",size:"md"}},bt=Object.assign({inheritAttrs:!1},{__name:"USwitch",props:Ve({as:{type:null,required:!1},color:{type:null,required:!1},size:{type:null,required:!1},loading:{type:Boolean,required:!1},loadingIcon:{type:null,required:!1},checkedIcon:{type:null,required:!1},uncheckedIcon:{type:null,required:!1},label:{type:String,required:!1},description:{type:String,required:!1},class:{type:null,required:!1},ui:{type:null,required:!1},disabled:{type:Boolean,required:!1},id:{type:String,required:!1},name:{type:String,required:!1},required:{type:Boolean,required:!1},value:{type:String,required:!1},defaultValue:{type:Boolean,required:!1}},{modelValue:{type:Boolean,default:void 0},modelModifiers:{}}),emits:Ve(["change"],["update:modelValue"]),setup(s,{emit:C}){const o=s,h=Xe(),u=C,_=je(s,"modelValue",{type:Boolean,default:void 0}),I=et(),g=At(tt(o,"required","value","defaultValue")),{id:r,emitFormChange:c,emitFormInput:y,size:x,color:S,name:D,disabled:$,ariaAttrs:q}=Rt(o),F=r.value??Dt(),B=T(()=>Ee({extend:Ee(xs),...I.ui?.switch||{}})({size:x.value,color:S.value,required:o.required,loading:o.loading,disabled:$.value||o.loading}));function H(L){const O=new Event("change",{target:{value:L}});u("change",O),c(),y()}return(L,O)=>(a(),j(e(Te),{as:s.as,"data-slot":"root",class:Q(B.value.root({class:[o.ui?.root,o.class]}))},{default:p(()=>[t("div",{"data-slot":"container",class:Q(B.value.container({class:o.ui?.container}))},[l(e(fs),Oe({id:e(F)},{...e(g),...L.$attrs,...e(q)},{modelValue:_.value,"onUpdate:modelValue":[O[0]||(O[0]=V=>_.value=V),H],name:e(D),disabled:e($)||s.loading,"data-slot":"base",class:B.value.base({class:o.ui?.base})}),{default:p(()=>[l(e(bs),{"data-slot":"thumb",class:Q(B.value.thumb({class:o.ui?.thumb}))},{default:p(()=>[s.loading?(a(),j(be,{key:0,name:s.loadingIcon||e(I).ui.icons.loading,"data-slot":"icon",class:Q(B.value.icon({class:o.ui?.icon,checked:!0,unchecked:!0}))},null,8,["name","class"])):(a(),m(ve,{key:1},[s.checkedIcon?(a(),j(be,{key:0,name:s.checkedIcon,"data-slot":"icon",class:Q(B.value.icon({class:o.ui?.icon,checked:!0}))},null,8,["name","class"])):v("",!0),s.uncheckedIcon?(a(),j(be,{key:1,name:s.uncheckedIcon,"data-slot":"icon",class:Q(B.value.icon({class:o.ui?.icon,unchecked:!0}))},null,8,["name","class"])):v("",!0)],64))]),_:1},8,["class"])]),_:1},16,["id","modelValue","name","disabled","class"])],2),s.label||h.label||s.description||h.description?(a(),m("div",{key:0,"data-slot":"wrapper",class:Q(B.value.wrapper({class:o.ui?.wrapper}))},[s.label||h.label?(a(),j(e(Pt),{key:0,for:e(F),"data-slot":"label",class:Q(B.value.label({class:o.ui?.label}))},{default:p(()=>[xe(L.$slots,"label",{label:s.label},()=>[te(U(s.label),1)])]),_:3},8,["for","class"])):v("",!0),s.description||h.description?(a(),m("p",{key:1,"data-slot":"description",class:Q(B.value.description({class:o.ui?.description}))},[xe(L.$slots,"description",{description:s.description},()=>[te(U(s.description),1)])],2)):v("",!0)],2)):v("",!0)]),_:3},8,["as","class"]))}}),gs={slots:{root:"",content:"data-[state=open]:animate-[collapsible-down_200ms_ease-out] data-[state=closed]:animate-[collapsible-up_200ms_ease-out] overflow-hidden"}},ks={__name:"UCollapsible",props:{as:{type:null,required:!1},class:{type:null,required:!1},ui:{type:null,required:!1},defaultOpen:{type:Boolean,required:!1},open:{type:Boolean,required:!1},disabled:{type:Boolean,required:!1},unmountOnHide:{type:Boolean,required:!1,default:!0}},emits:["update:open"],setup(s,{emit:C}){const o=s,h=C,u=Xe(),_=et(),I=Et(tt(o,"as","defaultOpen","open","disabled","unmountOnHide"),h),g=T(()=>Ee({extend:Ee(gs),..._.ui?.collapsible||{}})());return(r,c)=>(a(),j(e(ns),Oe(e(I),{"data-slot":"root",class:g.value.root({class:[o.ui?.root,o.class]})}),{default:p(({open:y})=>[u.default?(a(),j(e(ds),{key:0,"as-child":""},{default:p(()=>[xe(r.$slots,"default",{open:y})]),_:2},1024)):v("",!0),l(e(rs),{"data-slot":"content",class:Q(g.value.content({class:o.ui?.content}))},{default:p(()=>[xe(r.$slots,"content")]),_:3},8,["class"])]),_:3},16,["class"]))}},ys={class:"space-y-4"},hs={class:"inline-flex items-center gap-1.5"},ws={key:0,class:"space-y-3"},_s={class:"flex items-center gap-2 text-sm"},$s={class:"text-(--ui-text)"},Is={class:"flex items-center gap-2 text-sm"},Ts={class:"text-(--ui-text) font-mono"},Cs={key:1,class:"text-(--ui-text-muted) text-sm"},Ss={class:"flex gap-3 flex-wrap"},Us=["src"],Vs=["onClick"],Ms={key:0,class:"w-24 h-24 rounded-lg border-2 border-dashed border-(--ui-border-accented) hover:border-(--ui-primary) transition-colors flex flex-col items-center justify-center cursor-pointer"},As={class:"inline-flex items-center gap-2"},Rs={class:"text-sm text-(--ui-text-muted)"},Ds={key:0,class:"ml-1 text-(--ui-primary)"},Es={class:"pt-4 space-y-4"},Bs={key:0,class:"text-center py-4 text-(--ui-text-muted) text-sm"},Os={key:9,class:"flex items-center justify-between"},js=ce({__name:"ImageForm",props:{upstreams:{}},emits:["submit"],setup(s,{expose:C,emit:o}){const h=o,u=$e(),{getAuthHeader:_}=Bt(),{settings:I,isLoaded:g,loadSettings:r}=mt(),c=k(""),y=k(""),x=k([]),S=k(!1),D=k(null),$=k(null),q=k("1024x1024"),F=k("standard"),B=k("vivid"),H=k("1:1"),L=k(-1),O=k(2.5),V=k(!0),M=k("auto"),W=[{label:"1024x1024 (方形)",value:"1024x1024"},{label:"1792x1024 (横版)",value:"1792x1024"},{label:"1024x1792 (竖版)",value:"1024x1792"}],z=[{label:"1024x1024 (1:1)",value:"1024x1024"},{label:"1152x864 (4:3)",value:"1152x864"},{label:"864x1152 (3:4)",value:"864x1152"},{label:"1280x720 (16:9)",value:"1280x720"},{label:"720x1280 (9:16)",value:"720x1280"},{label:"1248x832 (3:2)",value:"1248x832"},{label:"832x1248 (2:3)",value:"832x1248"}],ae=[{label:"自动",value:"auto"},{label:"1024x1024 (方形)",value:"1024x1024"},{label:"1536x1024 (横版)",value:"1536x1024"},{label:"1024x1536 (竖版)",value:"1024x1536"}],ie=[{label:"标准",value:"standard"},{label:"高清",value:"hd"}],R=[{label:"高",value:"high"},{label:"中",value:"medium"},{label:"低",value:"low"}],d=[{label:"生动 (超现实)",value:"vivid"},{label:"自然",value:"natural"}],X=[{label:"1:1 (方形)",value:"1:1"},{label:"16:9 (横屏)",value:"16:9"},{label:"9:16 (竖屏)",value:"9:16"},{label:"4:3",value:"4:3"},{label:"3:4",value:"3:4"},{label:"3:2",value:"3:2"},{label:"2:3",value:"2:3"},{label:"21:9 (超宽)",value:"21:9"}],w=[{label:"自动",value:"auto"},{label:"透明",value:"transparent"},{label:"不透明",value:"opaque"}],b=k(!1);Be(async()=>{g.value||await r()}),he(g,N=>{if(N&&!D.value&&!$.value){const n=I.value[_e.DRAWING_WORKBENCH_UPSTREAM_ID],pe=I.value[_e.DRAWING_WORKBENCH_AIMODEL_ID];n&&pe&&(D.value=n,$.value=pe)}},{immediate:!0});const ee=T(()=>{const N=I.value[_e.DRAWING_AI_OPTIMIZE_UPSTREAM_ID],n=I.value[_e.DRAWING_AI_OPTIMIZE_AIMODEL_ID];return N&&n});async function Y(){if(!c.value.trim()){u.add({title:"请先输入提示词",color:"warning"});return}if(!ee.value){u.add({title:"请先在设置中配置 AI 优化模型",color:"warning"});return}b.value=!0;try{const N=await $fetch("/api/prompts/optimize",{method:"POST",headers:_(),body:{prompt:c.value,upstreamId:I.value[_e.DRAWING_AI_OPTIMIZE_UPSTREAM_ID],aimodelId:I.value[_e.DRAWING_AI_OPTIMIZE_AIMODEL_ID],modelName:I.value[_e.DRAWING_AI_OPTIMIZE_MODEL_NAME],targetModelType:A.value?.modelType,targetModelName:A.value?.modelName}});N.success&&N.optimizedPrompt&&(c.value=N.optimizedPrompt,N.negativePrompt&&f.value?(y.value=N.negativePrompt,u.add({title:"提示词已优化",description:"已填充负面提示词",color:"success"})):u.add({title:"提示词已优化",color:"success"}))}catch(N){u.add({title:"优化失败",description:N.data?.message||N.message,color:"error"})}finally{b.value=!1}}const J=k(null),A=T(()=>J.value?.selectedAimodel),G=T(()=>!(!A.value?.apiFormat||Nt.includes(A.value.modelType))),f=T(()=>A.value?Wt.includes(A.value.modelType):!1),oe=T(()=>A.value?.modelType==="dalle"),ue=T(()=>A.value?.modelType==="doubao");T(()=>A.value?.modelType==="flux");const ne=T(()=>A.value?.modelType==="gpt4o-image"),i=T(()=>A.value?Gt.includes(A.value.modelType):!1),me=T(()=>A.value?Ht.includes(A.value.modelType):!1),fe=T(()=>A.value?Kt.includes(A.value.modelType):!1),le=T(()=>A.value?Zt.includes(A.value.modelType):!1),ge=T(()=>A.value?Jt.includes(A.value.modelType):!1),K=T(()=>A.value?Yt.includes(A.value.modelType):!1),se=T(()=>A.value?Qt.includes(A.value.modelType):!1),de=T(()=>A.value?Xt.includes(A.value.modelType):!1),ke=T(()=>oe.value?W:ue.value?z:ne.value?ae:W),qe=T(()=>ne.value?R:ie),P=T(()=>{let N=0;return f.value&&N++,i.value&&N++,me.value&&N++,fe.value&&N++,le.value&&N++,ge.value&&N++,K.value&&N++,se.value&&N++,de.value&&N++,N}),Se=k(!1),We=k(!1);async function ht(N){const n=N.target;if(!n.files?.length)return;const pe=Array.from(n.files).slice(0,De-x.value.length);for(const Re of pe){if(Re.size>rt){u.add({title:"图片大小不能超过10MB",color:"error"});continue}We.value=!0;try{const re=new FormData;re.append("file",Re);const we=await $fetch("/api/images/upload",{method:"POST",body:re});we.success&&x.value.length<De&&x.value.push(we.url)}catch(re){u.add({title:"图片上传失败",description:re.message,color:"error"})}finally{We.value=!1}}n.value=""}function wt(N){x.value.splice(N,1)}async function _t(){if(!(!c.value.trim()&&x.value.length===0)){if(!D.value||$.value===null||!A.value){u.add({title:"请先选择模型配置",color:"warning"});return}if(!G.value&&x.value.length>0&&!c.value.trim()){u.add({title:"当前模型需要输入提示词",color:"warning"});return}S.value=!0;try{const N=G.value?x.value:[],n={};f.value&&y.value&&(n.negativePrompt=y.value),i.value&&q.value&&(n.size=q.value),me.value&&F.value&&(n.quality=F.value),fe.value&&B.value&&(n.style=B.value),le.value&&H.value&&(n.aspectRatio=H.value),ge.value&&L.value!==-1&&(n.seed=L.value),K.value&&(n.guidanceScale=O.value),se.value&&(n.watermark=V.value),de.value&&M.value!=="auto"&&(n.background=M.value),h("submit",{prompt:c.value,images:N,upstreamId:D.value,aimodelId:$.value,modelType:A.value.modelType,apiFormat:A.value.apiFormat,modelName:A.value.modelName,modelParams:n})}finally{S.value=!1}}}function $t(N,n,pe){c.value=N||"",y.value=n?.negativePrompt||"",x.value=pe.slice(0,De),n&&(n.size&&(q.value=n.size),n.quality&&(F.value=n.quality),n.style&&(B.value=n.style),n.aspectRatio&&(H.value=n.aspectRatio),n.seed!==void 0&&(L.value=n.seed),n.guidanceScale!==void 0&&(O.value=n.guidanceScale),n.watermark!==void 0&&(V.value=n.watermark),n.background&&(M.value=n.background))}return C({setContent:$t}),(N,n)=>{const pe=be,Re=at,re=ot,we=Ce,It=Ie,Ge=nt,Ue=it,He=Fe,Tt=bt,Ct=ks;return a(),m("div",ys,[l(re,{label:"选择模型"},{label:p(()=>[t("span",hs,[n[15]||(n[15]=te(" 选择模型 ",-1)),e(A)?(a(),m("button",{key:0,type:"button",class:"inline-flex items-center text-(--ui-text-muted) hover:text-(--ui-text) transition-colors",onClick:n[0]||(n[0]=Z=>Se.value=!0)},[l(pe,{name:"i-heroicons-information-circle",class:"w-3.5 h-3.5"})])):v("",!0)])]),default:p(()=>[l(Re,{ref_key:"modelSelectorRef",ref:J,upstreams:s.upstreams,category:"image","show-type-label":"","upstream-id":e(D),"onUpdate:upstreamId":n[1]||(n[1]=Z=>E(D)?D.value=Z:null),"aimodel-id":e($),"onUpdate:aimodelId":n[2]||(n[2]=Z=>E($)?$.value=Z:null)},null,8,["upstreams","upstream-id","aimodel-id"])]),_:1}),l(It,{open:e(Se),"onUpdate:open":n[4]||(n[4]=Z=>E(Se)?Se.value=Z:null),title:"模型信息"},{body:p(()=>[e(A)?(a(),m("div",ws,[t("div",_s,[n[16]||(n[16]=t("span",{class:"text-(--ui-text-muted)"},"请求格式：",-1)),t("span",$s,U(e(Le)[e(A).apiFormat]||e(A).apiFormat),1)]),t("div",Is,[n[17]||(n[17]=t("span",{class:"text-(--ui-text-muted)"},"模型名称：",-1)),t("span",Ts,U(e(A).modelName),1)])])):(a(),m("p",Cs,"请先选择一个模型"))]),footer:p(()=>[l(we,{variant:"ghost",onClick:n[3]||(n[3]=Z=>Se.value=!1)},{default:p(()=>[...n[18]||(n[18]=[te("关闭",-1)])]),_:1})]),_:1},8,["open"]),n[29]||(n[29]=t("div",{class:"border-t border-(--ui-border)"},null,-1)),e(G)?(a(),j(re,{key:0,label:"参考图 (可选)"},{hint:p(()=>[...n[19]||(n[19]=[t("span",{class:"text-(--ui-text-dimmed) text-xs"},"支持 JPG、PNG，单张最大10MB",-1)])]),default:p(()=>[t("div",Ss,[(a(!0),m(ve,null,Ae(e(x),(Z,Ke)=>(a(),m("div",{key:Ke,class:"relative w-24 h-24 rounded-lg overflow-hidden group"},[t("img",{src:Z,class:"w-full h-full object-cover"},null,8,Us),t("button",{type:"button",class:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",onClick:ro=>wt(Ke)},[l(pe,{name:"i-heroicons-x-mark",class:"w-6 h-6 text-white"})],8,Vs)]))),128)),e(x).length<e(De)?(a(),m("label",Ms,[l(pe,{name:"i-heroicons-cloud-arrow-up",class:"w-8 h-8 text-(--ui-text-dimmed) mb-1"}),n[20]||(n[20]=t("span",{class:"text-(--ui-text-dimmed) text-xs"},"上传",-1)),t("input",{type:"file",accept:"image/png,image/jpeg",multiple:"",class:"hidden",onChange:ht},null,32)])):v("",!0)])]),_:1})):v("",!0),l(re,{label:"描述你想要的图片"},{label:p(()=>[t("span",As,[n[22]||(n[22]=te(" 描述你想要的图片 ",-1)),l(we,{size:"xs",variant:"soft",loading:e(b),disabled:!e(c).trim()||!e(ee),onClick:Y},{default:p(()=>[l(pe,{name:"i-heroicons-sparkles",class:"w-3.5 h-3.5 mr-1"}),n[21]||(n[21]=te(" AI 优化 ",-1))]),_:1},8,["loading","disabled"])])]),default:p(()=>[l(Ge,{modelValue:e(c),"onUpdate:modelValue":n[5]||(n[5]=Z=>E(c)?c.value=Z:null),placeholder:"例如：一只可爱的小猫咪坐在花园里，油画风格，高清，细节丰富",rows:8,class:"w-full"},null,8,["modelValue"])]),_:1}),e(A)?(a(),j(Ct,{key:1},{content:p(()=>[t("div",Es,[e(P)===0?(a(),m("div",Bs," 该模型没有高级选项 ")):v("",!0),e(f)?(a(),j(re,{key:1,label:"负面提示词"},{hint:p(()=>[...n[24]||(n[24]=[t("span",{class:"text-(--ui-text-dimmed) text-xs"},"描述不希望出现的内容",-1)])]),default:p(()=>[l(Ge,{modelValue:e(y),"onUpdate:modelValue":n[6]||(n[6]=Z=>E(y)?y.value=Z:null),placeholder:"例如：模糊、低质量、变形、水印",rows:3,class:"w-full"},null,8,["modelValue"])]),_:1})):v("",!0),e(i)?(a(),j(re,{key:2,label:"尺寸"},{default:p(()=>[l(Ue,{modelValue:e(q),"onUpdate:modelValue":n[7]||(n[7]=Z=>E(q)?q.value=Z:null),items:e(ke),"value-key":"value","label-key":"label",class:"w-full"},null,8,["modelValue","items"])]),_:1})):v("",!0),e(le)?(a(),j(re,{key:3,label:"宽高比"},{default:p(()=>[l(Ue,{modelValue:e(H),"onUpdate:modelValue":n[8]||(n[8]=Z=>E(H)?H.value=Z:null),items:X,"value-key":"value","label-key":"label",class:"w-full"},null,8,["modelValue"])]),_:1})):v("",!0),e(me)?(a(),j(re,{key:4,label:"质量"},{default:p(()=>[l(Ue,{modelValue:e(F),"onUpdate:modelValue":n[9]||(n[9]=Z=>E(F)?F.value=Z:null),items:e(qe),"value-key":"value","label-key":"label",class:"w-full"},null,8,["modelValue","items"])]),_:1})):v("",!0),e(fe)?(a(),j(re,{key:5,label:"风格"},{default:p(()=>[l(Ue,{modelValue:e(B),"onUpdate:modelValue":n[10]||(n[10]=Z=>E(B)?B.value=Z:null),items:d,"value-key":"value","label-key":"label",class:"w-full"},null,8,["modelValue"])]),_:1})):v("",!0),e(de)?(a(),j(re,{key:6,label:"背景"},{default:p(()=>[l(Ue,{modelValue:e(M),"onUpdate:modelValue":n[11]||(n[11]=Z=>E(M)?M.value=Z:null),items:w,"value-key":"value","label-key":"label",class:"w-full"},null,8,["modelValue"])]),_:1})):v("",!0),e(K)?(a(),j(re,{key:7,label:"提示词相关度"},{hint:p(()=>[...n[25]||(n[25]=[t("span",{class:"text-(--ui-text-dimmed) text-xs"},"值越大与提示词相关性越强 (1-10)",-1)])]),default:p(()=>[l(He,{modelValue:e(O),"onUpdate:modelValue":n[12]||(n[12]=Z=>E(O)?O.value=Z:null),modelModifiers:{number:!0},type:"number",min:1,max:10,step:.5,class:"w-full"},null,8,["modelValue"])]),_:1})):v("",!0),e(ge)?(a(),j(re,{key:8,label:"随机种子"},{hint:p(()=>[...n[26]||(n[26]=[t("span",{class:"text-(--ui-text-dimmed) text-xs"},"-1 表示自动生成",-1)])]),default:p(()=>[l(He,{modelValue:e(L),"onUpdate:modelValue":n[13]||(n[13]=Z=>E(L)?L.value=Z:null),modelModifiers:{number:!0},type:"number",min:-1,max:2147483647,class:"w-full"},null,8,["modelValue"])]),_:1})):v("",!0),e(se)?(a(),m("div",Os,[n[27]||(n[27]=t("div",{class:"flex flex-col"},[t("span",{class:"text-sm text-(--ui-text)"},"添加水印"),t("span",{class:"text-xs text-(--ui-text-dimmed)"},'在图片右下角添加"AI生成"水印')],-1)),l(Tt,{modelValue:e(V),"onUpdate:modelValue":n[14]||(n[14]=Z=>E(V)?V.value=Z:null)},null,8,["modelValue"])])):v("",!0)])]),default:p(()=>[l(we,{variant:"ghost",block:"",class:"justify-between",ui:{trailingIconLeadingClass:"ms-auto"}},{trailing:p(()=>[l(pe,{name:"i-heroicons-chevron-down",class:"w-4 h-4 transition-transform group-data-[state=open]:rotate-180"})]),default:p(()=>[t("span",Rs,[n[23]||(n[23]=te(" 高级选项 ",-1)),e(P)>0?(a(),m("span",Ds,"+"+U(e(P)),1)):v("",!0)])]),_:1})]),_:1})):v("",!0),l(we,{block:"",size:"lg",loading:e(S),disabled:!e(c).trim()&&e(x).length===0||!e(D)||e($)===null||s.upstreams.length===0,class:"bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600",onClick:_t},{default:p(()=>[l(pe,{name:"i-heroicons-sparkles",class:"w-5 h-5 mr-2"}),n[28]||(n[28]=te(" 开始生成 ",-1))]),_:1},8,["loading","disabled"])])}}}),qs=Object.assign(js,{__name:"StudioImageForm"}),Ps={class:"space-y-4"},Fs={class:"inline-flex items-center gap-1.5"},Ls={key:0,class:"space-y-3"},zs={class:"flex items-center gap-2 text-sm"},Ns={class:"text-(--ui-text)"},Ws={class:"flex items-center gap-2 text-sm"},Gs={class:"text-(--ui-text) font-mono"},Hs={key:1,class:"text-(--ui-text-muted) text-sm"},Ks={class:"flex gap-3 flex-wrap"},Zs={key:0,class:"relative w-24 h-24 rounded-lg overflow-hidden group"},Js=["src"],Ys={key:1,class:"w-24 h-24 rounded-lg border-2 border-dashed border-(--ui-border-accented) hover:border-(--ui-primary) transition-colors flex flex-col items-center justify-center cursor-pointer"},Qs={class:"space-y-4"},Xs={class:"flex items-center justify-between"},el={class:"flex items-center justify-between"},tl={class:"space-y-4"},sl={class:"flex items-center justify-between"},ll={class:"flex items-center justify-between"},al=ce({__name:"VideoForm",props:{upstreams:{}},emits:["submit"],setup(s,{expose:C,emit:o}){const h=o,u=$e(),{isLoaded:_,loadSettings:I}=mt(),g=k(""),r=k([]),c=k(!1),y=k(null),x=k(null),S=k("16:9"),D=k("1080P"),$=k(!0),q=k(!1),F=k("landscape"),B=k("small"),H=k(10),L=k(!1),O=k(!1),V=[{label:"16:9 (横屏)",value:"16:9"},{label:"9:16 (竖屏)",value:"9:16"},{label:"4:3",value:"4:3"},{label:"3:4",value:"3:4"},{label:"1:1 (方形)",value:"1:1"},{label:"21:9 (超宽)",value:"21:9"}],M=[{label:"1080P",value:"1080P"},{label:"1280x720",value:"1280x720"},{label:"720x1280",value:"720x1280"}],W=[{label:"横屏",value:"landscape"},{label:"竖屏",value:"portrait"}],z=[{label:"标准 (720p)",value:"small"},{label:"高清",value:"large"}],ae=[{label:"10 秒",value:10},{label:"15 秒",value:15}],ie=[{label:"3:2 (横屏)",value:"3:2"},{label:"2:3 (竖屏)",value:"2:3"},{label:"1:1 (方形)",value:"1:1"}];Be(async()=>{_.value||await I()});const R=k(null),d=T(()=>R.value?.selectedAimodel),X=T(()=>d.value?.modelType==="jimeng-video"),w=T(()=>d.value?.modelType==="veo"),b=T(()=>d.value?.modelType==="sora"),ee=T(()=>d.value?.modelType==="grok-video"),Y=V.filter(ne=>["16:9","9:16"].includes(ne.value)),J=k(!1),A=k(!1);async function G(ne){const i=ne.target;if(!i.files?.length)return;const me=i.files[0];if(me.size>rt){u.add({title:"图片大小不能超过10MB",color:"error"}),i.value="";return}A.value=!0;try{const fe=new FormData;fe.append("file",me);const le=await $fetch("/api/images/upload",{method:"POST",body:fe});le.success&&(r.value=[le.url])}catch(fe){u.add({title:"图片上传失败",description:fe.message,color:"error"})}finally{A.value=!1}i.value=""}function f(){r.value=[]}async function oe(){if(!g.value.trim()){u.add({title:"请输入提示词",color:"warning"});return}if(!y.value||x.value===null||!d.value){u.add({title:"请先选择模型配置",color:"warning"});return}c.value=!0;try{let ne={};X.value?ne={aspectRatio:S.value,size:D.value}:w.value?ne={aspectRatio:Y.some(i=>i.value===S.value)?S.value:"16:9",enhancePrompt:$.value,enableUpsample:q.value}:b.value?ne={orientation:F.value,size:B.value,duration:H.value,watermark:L.value,private:O.value}:ee.value&&(ne={aspectRatio:ie.some(i=>i.value===S.value)?S.value:"3:2",size:"720P"}),h("submit",{prompt:g.value,images:r.value,upstreamId:y.value,aimodelId:x.value,modelType:d.value.modelType,apiFormat:d.value.apiFormat,modelName:d.value.modelName,modelParams:ne})}finally{c.value=!1}}function ue(ne,i){g.value=ne||"",r.value=i.slice(0,1)}return C({setContent:ue}),(ne,i)=>{const me=be,fe=at,le=ot,ge=Ce,K=Ie,se=nt,de=it,ke=bt,qe=Fe;return a(),m("div",Ps,[l(le,{label:"选择模型"},{label:p(()=>[t("span",Fs,[i[17]||(i[17]=te(" 选择模型 ",-1)),e(d)?(a(),m("button",{key:0,type:"button",class:"inline-flex items-center text-(--ui-text-muted) hover:text-(--ui-text) transition-colors",onClick:i[0]||(i[0]=P=>J.value=!0)},[l(me,{name:"i-heroicons-information-circle",class:"w-3.5 h-3.5"})])):v("",!0)])]),default:p(()=>[l(fe,{ref_key:"modelSelectorRef",ref:R,upstreams:s.upstreams,category:"video","show-type-label":"","upstream-id":e(y),"onUpdate:upstreamId":i[1]||(i[1]=P=>E(y)?y.value=P:null),"aimodel-id":e(x),"onUpdate:aimodelId":i[2]||(i[2]=P=>E(x)?x.value=P:null)},null,8,["upstreams","upstream-id","aimodel-id"])]),_:1}),l(K,{open:e(J),"onUpdate:open":i[4]||(i[4]=P=>E(J)?J.value=P:null),title:"模型信息"},{body:p(()=>[e(d)?(a(),m("div",Ls,[t("div",zs,[i[18]||(i[18]=t("span",{class:"text-(--ui-text-muted)"},"请求格式：",-1)),t("span",Ns,U(e(Le)[e(d).apiFormat]||e(d).apiFormat),1)]),t("div",Ws,[i[19]||(i[19]=t("span",{class:"text-(--ui-text-muted)"},"模型名称：",-1)),t("span",Gs,U(e(d).modelName),1)])])):(a(),m("p",Hs,"请先选择一个模型"))]),footer:p(()=>[l(ge,{variant:"ghost",onClick:i[3]||(i[3]=P=>J.value=!1)},{default:p(()=>[...i[20]||(i[20]=[te("关闭",-1)])]),_:1})]),_:1},8,["open"]),i[28]||(i[28]=t("div",{class:"border-t border-(--ui-border)"},null,-1)),e(d)?(a(),j(le,{key:0,label:"参考图 (可选)"},{hint:p(()=>[...i[21]||(i[21]=[t("span",{class:"text-(--ui-text-dimmed) text-xs"},"支持 JPG、PNG，最大10MB",-1)])]),default:p(()=>[t("div",Ks,[e(r).length>0?(a(),m("div",Zs,[t("img",{src:e(r)[0],class:"w-full h-full object-cover"},null,8,Js),t("button",{type:"button",class:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",onClick:f},[l(me,{name:"i-heroicons-x-mark",class:"w-6 h-6 text-white"})])])):v("",!0),e(r).length===0?(a(),m("label",Ys,[l(me,{name:"i-heroicons-cloud-arrow-up",class:"w-8 h-8 text-(--ui-text-dimmed) mb-1"}),i[22]||(i[22]=t("span",{class:"text-(--ui-text-dimmed) text-xs"},"上传",-1)),t("input",{type:"file",accept:"image/png,image/jpeg",class:"hidden",onChange:G},null,32)])):v("",!0)])]),_:1})):v("",!0),l(le,{label:"描述你想要的视频"},{default:p(()=>[l(se,{modelValue:e(g),"onUpdate:modelValue":i[5]||(i[5]=P=>E(g)?g.value=P:null),placeholder:"例如：一只猫在草地上奔跑，慢动作，电影感",rows:6,class:"w-full"},null,8,["modelValue"])]),_:1}),e(X)?(a(),m(ve,{key:1},[l(le,{label:"宽高比"},{default:p(()=>[l(de,{modelValue:e(S),"onUpdate:modelValue":i[6]||(i[6]=P=>E(S)?S.value=P:null),items:V,"value-key":"value","label-key":"label",class:"w-full"},null,8,["modelValue"])]),_:1}),l(le,{label:"分辨率"},{default:p(()=>[l(de,{modelValue:e(D),"onUpdate:modelValue":i[7]||(i[7]=P=>E(D)?D.value=P:null),items:M,"value-key":"value","label-key":"label",class:"w-full"},null,8,["modelValue"])]),_:1})],64)):v("",!0),e(w)?(a(),m(ve,{key:2},[l(le,{label:"宽高比"},{default:p(()=>[l(de,{modelValue:e(S),"onUpdate:modelValue":i[8]||(i[8]=P=>E(S)?S.value=P:null),items:e(Y),"value-key":"value","label-key":"label",class:"w-full"},null,8,["modelValue","items"])]),_:1}),t("div",Qs,[t("div",Xs,[i[23]||(i[23]=t("div",{class:"flex flex-col"},[t("span",{class:"text-sm text-(--ui-text)"},"提示词增强"),t("span",{class:"text-xs text-(--ui-text-dimmed)"},"自动优化和翻译提示词")],-1)),l(ke,{modelValue:e($),"onUpdate:modelValue":i[9]||(i[9]=P=>E($)?$.value=P:null)},null,8,["modelValue"])]),t("div",el,[i[24]||(i[24]=t("div",{class:"flex flex-col"},[t("span",{class:"text-sm text-(--ui-text)"},"超分辨率"),t("span",{class:"text-xs text-(--ui-text-dimmed)"},"提升视频画质（耗时更长）")],-1)),l(ke,{modelValue:e(q),"onUpdate:modelValue":i[10]||(i[10]=P=>E(q)?q.value=P:null)},null,8,["modelValue"])])])],64)):v("",!0),e(b)?(a(),m(ve,{key:3},[l(le,{label:"方向"},{default:p(()=>[l(de,{modelValue:e(F),"onUpdate:modelValue":i[11]||(i[11]=P=>E(F)?F.value=P:null),items:W,"value-key":"value","label-key":"label",class:"w-full"},null,8,["modelValue"])]),_:1}),l(le,{label:"分辨率"},{default:p(()=>[l(de,{modelValue:e(B),"onUpdate:modelValue":i[12]||(i[12]=P=>E(B)?B.value=P:null),items:z,"value-key":"value","label-key":"label",class:"w-full"},null,8,["modelValue"])]),_:1}),l(le,{label:"时长"},{default:p(()=>[l(de,{modelValue:e(H),"onUpdate:modelValue":i[13]||(i[13]=P=>E(H)?H.value=P:null),items:ae,"value-key":"value","label-key":"label",class:"w-full"},null,8,["modelValue"])]),_:1}),t("div",tl,[t("div",sl,[i[25]||(i[25]=t("div",{class:"flex flex-col"},[t("span",{class:"text-sm text-(--ui-text)"},"添加水印"),t("span",{class:"text-xs text-(--ui-text-dimmed)"},"在视频上添加水印")],-1)),l(ke,{modelValue:e(L),"onUpdate:modelValue":i[14]||(i[14]=P=>E(L)?L.value=P:null)},null,8,["modelValue"])]),t("div",ll,[i[26]||(i[26]=t("div",{class:"flex flex-col"},[t("span",{class:"text-sm text-(--ui-text)"},"隐私模式"),t("span",{class:"text-xs text-(--ui-text-dimmed)"},"视频不公开")],-1)),l(ke,{modelValue:e(O),"onUpdate:modelValue":i[15]||(i[15]=P=>E(O)?O.value=P:null)},null,8,["modelValue"])])])],64)):v("",!0),e(ee)?(a(),m(ve,{key:4},[l(le,{label:"宽高比"},{default:p(()=>[l(de,{modelValue:e(S),"onUpdate:modelValue":i[16]||(i[16]=P=>E(S)?S.value=P:null),items:ie,"value-key":"value","label-key":"label",class:"w-full"},null,8,["modelValue"])]),_:1}),l(le,{label:"分辨率"},{default:p(()=>[l(qe,{value:"720P",disabled:"",class:"w-full"})]),_:1})],64)):v("",!0),l(ge,{block:"",size:"lg",loading:e(c),disabled:!e(g).trim()||!e(y)||e(x)===null||s.upstreams.length===0,class:"bg-gradient-to-r from-indigo-500 to-purple-500 hover:from-indigo-600 hover:to-purple-600",onClick:oe},{default:p(()=>[l(me,{name:"i-heroicons-video-camera",class:"w-5 h-5 mr-2"}),i[27]||(i[27]=te(" 开始生成 ",-1))]),_:1},8,["loading","disabled"])])}}}),ol=Object.assign(al,{__name:"StudioVideoForm"}),nl={class:"space-y-4"},il={class:"flex items-center justify-between"},rl={class:"flex items-center gap-2"},ul={href:"/help/",class:"text-(--ui-text-muted) hover:text-(--ui-text) transition-colors",title:"帮助中心"},dl={class:"flex border-b border-(--ui-border)"},cl=["disabled","onClick"],ml={key:2,class:"bg-(--ui-bg-elevated) rounded-lg p-8 border border-(--ui-border) text-center"},pl=ce({__name:"Workbench",props:{upstreams:{}},emits:["submitImage","submitVideo"],setup(s,{expose:C,emit:o}){const h=s,u=o,_=k("image"),I=[{label:"图片",value:"image",icon:"i-heroicons-photo"},{label:"视频",value:"video",icon:"i-heroicons-video-camera"}],g=T(()=>h.upstreams.some(D=>D.aimodels?.some($=>$.category==="video"&&!$.deletedAt))),r=k(null),c=k(null);function y(D){u("submitImage",D)}function x(D){u("submitVideo",D)}function S(D,$,q){_.value==="video"&&c.value?c.value.setContent(D,q):r.value&&r.value.setContent(D,$,q)}return C({setContent:S}),(D,$)=>{const q=be,F=st,B=qs,H=ol,L=Ce;return a(),m("div",nl,[t("div",il,[$[0]||($[0]=t("h2",{class:"text-(--ui-text) text-lg font-medium"},"创作工作台",-1)),t("div",rl,[l(F,{to:"/workflow",class:"text-(--ui-text-muted) hover:text-(--ui-primary) transition-colors",title:"工作流编排"},{default:p(()=>[l(q,{name:"i-heroicons-square-3-stack-3d",class:"w-5 h-5"})]),_:1}),t("a",ul,[l(q,{name:"i-heroicons-question-mark-circle",class:"w-5 h-5"})])])]),t("div",dl,[(a(),m(ve,null,Ae(I,O=>t("button",{key:O.value,class:Q(["flex items-center gap-1.5 px-4 py-2 text-sm font-medium transition-colors border-b-2 -mb-px",e(_)===O.value?"border-(--ui-primary) text-(--ui-primary)":"border-transparent text-(--ui-text-muted) hover:text-(--ui-text)",O.value==="video"&&!e(g)?"opacity-50 cursor-not-allowed":""]),disabled:O.value==="video"&&!e(g),onClick:V=>_.value=O.value},[l(q,{name:O.icon,class:"w-4 h-4"},null,8,["name"]),te(" "+U(O.label),1)],10,cl)),64))]),e(_)==="image"?(a(),j(B,{key:0,ref_key:"imageFormRef",ref:r,upstreams:s.upstreams,onSubmit:y},null,8,["upstreams"])):e(_)==="video"?(a(),j(H,{key:1,ref_key:"videoFormRef",ref:c,upstreams:s.upstreams,onSubmit:x},null,8,["upstreams"])):v("",!0),e(_)==="video"&&!e(g)?(a(),m("div",ml,[l(q,{name:"i-heroicons-video-camera",class:"w-12 h-12 text-(--ui-text-dimmed) mx-auto mb-3"}),$[2]||($[2]=t("p",{class:"text-(--ui-text-muted) mb-4"},"暂无视频模型配置",-1)),l(F,{to:"/settings/upstreams"},{default:p(()=>[l(L,{variant:"soft"},{default:p(()=>[l(q,{name:"i-heroicons-plus",class:"w-4 h-4 mr-1"}),$[1]||($[1]=te(" 添加视频模型 ",-1))]),_:1})]),_:1})])):v("",!0)])}}}),fl=Object.assign(pl,{__name:"StudioWorkbench"}),vl={class:"space-y-3 text-sm"},bl={class:"flex justify-between"},xl={class:"font-mono text-(--ui-text)"},gl={class:"flex justify-between"},kl={class:"text-(--ui-text)"},yl={class:"flex justify-between"},hl={class:"text-(--ui-text)"},wl={class:"flex justify-between"},_l={class:"text-(--ui-text)"},$l={class:"flex justify-between"},Il={class:"text-(--ui-text)"},Tl={key:0,class:"flex justify-between"},Cl={class:"text-(--ui-text) font-mono text-xs"},Sl={class:"flex justify-between"},Ul={class:"flex justify-between"},Vl={class:"text-(--ui-text)"},Ml={key:1,class:"flex justify-between"},Al={class:"text-(--ui-text)"},Rl={key:2,class:"flex justify-between"},Dl={class:"font-mono text-xs text-(--ui-text)"},El={key:3},Bl={class:"text-(--ui-text) bg-(--ui-bg-muted) rounded p-2 text-xs break-all"},Ol={key:4},jl={class:"text-(--ui-text) bg-(--ui-bg-muted) rounded p-2 text-xs break-all"},ql={key:5},Pl={class:"text-(--ui-error) bg-(--ui-error)/10 rounded p-2 text-xs break-all"},Fl=ce({__name:"TaskDetailModal",props:Ve({task:{}},{open:{type:Boolean,default:!1},openModifiers:{}}),emits:["update:open"],setup(s){const C=s,o=je(s,"open"),h=T(()=>{const g=C.task.modelType,r=ze[g]||{label:g||"未知",color:"bg-gray-500/80"};return{label:r.label,type:g,color:r.color}}),u=T(()=>{switch(C.task.status){case"pending":return{text:"等待中",color:"text-(--ui-warning)"};case"submitting":return{text:"提交中",color:"text-(--ui-info)"};case"processing":return{text:C.task.progress||"生成中",color:"text-(--ui-primary)"};case"success":return{text:"已完成",color:"text-(--ui-success)"};case"failed":return{text:"失败",color:"text-(--ui-error)"};case"cancelled":return{text:"已取消",color:"text-(--ui-text-muted)"};default:return{text:"未知",color:"text-(--ui-text-muted)"}}}),_=T(()=>{if(!C.task.createdAt)return null;const g=new Date(C.task.createdAt).getTime(),r=C.task.status==="success"||C.task.status==="failed"?new Date(C.task.updatedAt).getTime():Date.now(),c=Math.floor((r-g)/1e3);if(c<60)return`${c}秒`;const y=Math.floor(c/60),x=c%60;return`${y}分${x}秒`}),I=T(()=>C.task.taskType==="video"?"视频生成":C.task.type==="blend"?"图片混合":"文生图");return(g,r)=>{const c=Ie;return a(),j(c,{open:o.value,"onUpdate:open":r[0]||(r[0]=y=>o.value=y),title:"任务详情"},{body:p(()=>[t("div",vl,[t("div",bl,[r[1]||(r[1]=t("span",{class:"text-(--ui-text-muted)"},"任务ID",-1)),t("span",xl,U(s.task.id),1)]),t("div",gl,[r[2]||(r[2]=t("span",{class:"text-(--ui-text-muted)"},"任务类型",-1)),t("span",kl,U(e(I)),1)]),t("div",yl,[r[3]||(r[3]=t("span",{class:"text-(--ui-text-muted)"},"上游",-1)),t("span",hl,U(s.task.upstream?.name||"未知"),1)]),t("div",wl,[r[4]||(r[4]=t("span",{class:"text-(--ui-text-muted)"},"模型类型",-1)),t("span",_l,U(e(h).label),1)]),t("div",$l,[r[5]||(r[5]=t("span",{class:"text-(--ui-text-muted)"},"请求格式",-1)),t("span",Il,U(e(Le)[s.task.apiFormat]||s.task.apiFormat),1)]),s.task.modelName?(a(),m("div",Tl,[r[6]||(r[6]=t("span",{class:"text-(--ui-text-muted)"},"模型名称",-1)),t("span",Cl,U(s.task.modelName),1)])):v("",!0),t("div",Sl,[r[7]||(r[7]=t("span",{class:"text-(--ui-text-muted)"},"状态",-1)),t("span",{class:Q(e(u).color)},U(e(u).text),3)]),t("div",Ul,[r[8]||(r[8]=t("span",{class:"text-(--ui-text-muted)"},"创建时间",-1)),t("span",Vl,U(new Date(s.task.createdAt).toLocaleString("zh-CN")),1)]),e(_)?(a(),m("div",Ml,[r[9]||(r[9]=t("span",{class:"text-(--ui-text-muted)"},"耗时",-1)),t("span",Al,U(e(_)),1)])):v("",!0),s.task.upstreamTaskId?(a(),m("div",Rl,[r[10]||(r[10]=t("span",{class:"text-(--ui-text-muted)"},"上游任务ID",-1)),t("span",Dl,U(s.task.upstreamTaskId),1)])):v("",!0),s.task.prompt?(a(),m("div",El,[r[11]||(r[11]=t("span",{class:"text-(--ui-text-muted) block mb-1"},"提示词",-1)),t("p",Bl,U(s.task.prompt),1)])):v("",!0),s.task.modelParams?(a(),m("div",Ol,[r[12]||(r[12]=t("span",{class:"text-(--ui-text-muted) block mb-1"},"模型参数",-1)),t("p",jl,U(JSON.stringify(s.task.modelParams)),1)])):v("",!0),s.task.error?(a(),m("div",ql,[r[13]||(r[13]=t("span",{class:"text-(--ui-text-muted) block mb-1"},"错误信息",-1)),t("p",Pl,U(s.task.error),1)])):v("",!0)])]),_:1},8,["open"])}}}),xt=Object.assign(Fl,{__name:"StudioTaskDetailModal"}),Ll=["src","alt"],zl={class:"absolute bottom-2 left-2 px-2 py-1 rounded-full bg-black/50 backdrop-blur-sm text-xs text-white"},Nl=ce({__name:"RefImagesModal",props:Ve({images:{}},{open:{type:Boolean,default:!1},openModifiers:{}}),emits:["update:open"],setup(s){const C=je(s,"open");return(o,h)=>{const u=Ie;return a(),j(u,{open:C.value,"onUpdate:open":h[0]||(h[0]=_=>C.value=_),title:"参考图",ui:{content:"sm:max-w-3xl"}},{body:p(()=>[t("div",{class:Q(["grid gap-4",s.images.length===1?"grid-cols-1":"grid-cols-2"])},[(a(!0),m(ve,null,Ae(s.images,(_,I)=>(a(),m("div",{key:I,class:"relative bg-(--ui-bg-muted) rounded-lg overflow-hidden"},[t("img",{src:_,alt:`参考图 ${I+1}`,class:"w-full h-auto max-h-[60vh] object-contain"},null,8,Ll),t("div",zl,U(I+1)+" / "+U(s.images.length),1)]))),128))],2)]),_:1},8,["open"])}}}),gt=Object.assign(Nl,{__name:"StudioRefImagesModal"}),Wl={key:0,class:"text-center py-8"},Gl={key:1,class:"space-y-4 max-h-[70vh] overflow-y-auto"},Hl={class:"text-sm font-medium text-(--ui-text-muted)"},Kl={class:"text-xs text-(--ui-text-dimmed) ml-2"},Zl={key:0,class:"bg-(--ui-bg-muted) rounded-lg p-3 space-y-2"},Jl={class:"flex items-center gap-2 text-sm"},Yl={class:"font-mono text-(--ui-info)"},Ql={class:"font-mono text-(--ui-text) text-xs break-all"},Xl={class:"bg-(--ui-bg-muted) rounded-lg p-3 space-y-3"},ea={class:"flex items-center gap-2 text-sm"},ta={class:"bg-(--ui-bg) rounded p-2 text-xs overflow-x-auto max-h-48 text-(--ui-text)"},sa={key:1,class:"border-(--ui-border)"},la={key:2,class:"text-center py-8"},aa=ce({__name:"ErrorLogsModal",props:Ve({taskId:{}},{open:{type:Boolean,default:!1},openModifiers:{}}),emits:["update:open"],setup(s){const C=s,o=je(s,"open"),h=$e(),u=k(null),_=k(!1);return he(o,async I=>{if(I&&!u.value){_.value=!0;try{const g=await $fetch(`/api/tasks/${C.taskId}/logs`);u.value=g}catch(g){g?.statusCode===404&&(u.value=null,h.add({title:"无详情",description:"此错误无响应日志",color:"warning"}),o.value=!1)}finally{_.value=!1}}}),he(()=>C.taskId,()=>{u.value=null}),(I,g)=>{const r=Ne,c=be,y=Ie;return a(),j(y,{open:o.value,"onUpdate:open":g[0]||(g[0]=x=>o.value=x),title:"错误详情",ui:{content:"sm:max-w-2xl"}},{body:p(()=>[e(_)?(a(),m("div",Wl,[l(r,{class:"w-8 h-8 mx-auto mb-2 text-(--ui-primary)"}),g[1]||(g[1]=t("p",{class:"text-(--ui-text-muted) text-sm"},"加载中...",-1))])):e(u)?(a(),m("div",Gl,[(a(!0),m(ve,null,Ae(e(u).responses,(x,S)=>(a(),m("div",{key:S,class:"space-y-3"},[t("h4",Hl,[te(" 请求 "+U(S+1)+" / "+U(e(u).responses.length)+" ",1),t("span",Kl,U(x.timestamp),1)]),e(u).requests[S]?(a(),m("div",Zl,[t("div",Jl,[t("span",Yl,U(e(u).requests[S].method),1),t("span",Ql,U(e(u).requests[S].url),1)])])):v("",!0),t("div",Xl,[t("div",ea,[g[2]||(g[2]=t("span",{class:"text-(--ui-text-muted)"},"状态码",-1)),t("span",{class:Q(["font-mono font-medium",x.status>=400?"text-(--ui-error)":"text-(--ui-success)"])},U(x.status)+" "+U(x.statusText),3)]),t("div",null,[g[3]||(g[3]=t("span",{class:"text-(--ui-text-muted) text-sm block mb-1"},"响应内容",-1)),t("pre",ta,U(JSON.stringify(x.data,null,2)),1)])]),S<e(u).responses.length-1?(a(),m("hr",sa)):v("",!0)]))),128))])):(a(),m("div",la,[l(c,{name:"i-heroicons-document-magnifying-glass",class:"w-12 h-12 mx-auto mb-2 text-(--ui-text-dimmed)"}),g[4]||(g[4]=t("p",{class:"text-(--ui-text-muted) text-sm"},"无日志记录",-1))]))]),_:1},8,["open"])}}}),kt=Object.assign(aa,{__name:"StudioErrorLogsModal"}),oa={class:"bg-(--ui-bg-elevated) backdrop-blur-sm rounded-lg border border-(--ui-border) overflow-hidden"},na={class:"aspect-square relative bg-(--ui-bg-muted)"},ia=["src"],ra={key:1,class:"w-full h-full flex items-center justify-center p-4"},ua={class:"text-center"},da={key:2,class:"text-(--ui-error) text-xs leading-relaxed line-clamp-3 px-2 mb-2"},ca={key:2,class:"absolute bottom-12 left-0 right-0 flex justify-center"},ma={key:3,class:"absolute top-2 right-2 px-2 py-1 rounded-full bg-black/50 backdrop-blur-sm"},pa={class:"absolute top-2 left-2 flex gap-1"},fa={class:"absolute bottom-2 left-2 flex gap-1.5"},va={class:"px-2 py-1 rounded-full text-xs text-white font-medium bg-indigo-500/80"},ba={key:5,class:"absolute bottom-0 left-0 right-0 h-[3px] bg-black/20 overflow-hidden"},xa={class:"p-4"},ga={class:"flex items-center justify-between text-(--ui-text-dimmed) text-xs mb-2"},ka={class:"flex items-center gap-2"},ya={key:0},ha=["title"],wa={class:"flex justify-end gap-3"},_a={class:"relative bg-black flex items-center justify-center"},$a=["src"],Ia=ce({__name:"VideoCard",props:{task:{}},emits:["remove","retry","cancel","blur","copyToPanel"],setup(s,{emit:C}){const o=s,h=C,u=$e();async function _(){const R=String(o.task.id);try{await navigator.clipboard.writeText(R),u.add({title:"已复制",description:`ID:${R}`,color:"success"})}catch{const d=document.createElement("textarea");d.value=R,document.body.appendChild(d),d.select(),document.execCommand("copy"),document.body.removeChild(d),u.add({title:"已复制",description:`ID:${R}`,color:"success"})}}const I=k(o.task.isBlurred??!0);he(()=>o.task.isBlurred,R=>{R!==void 0&&(I.value=R)});async function g(R){I.value=R,h("blur",R);try{await $fetch(`/api/tasks/${o.task.id}/blur`,{method:"PATCH",body:{isBlurred:R}})}catch(d){console.error("保存模糊状态失败:",d)}}const r=T(()=>{switch(o.task.status){case"pending":return{text:"等待中",color:"text-(--ui-warning)",icon:"i-heroicons-clock",showBars:!1};case"submitting":return{text:"提交中",color:"text-(--ui-info)",icon:null,showBars:!0};case"processing":return{text:o.task.progress||"生成中",color:"text-(--ui-primary)",icon:null,showBars:!0};case"success":return{text:"已完成",color:"text-(--ui-success)",icon:"i-heroicons-check-circle",showBars:!1};case"failed":return{text:"失败",color:"text-(--ui-error)",icon:"i-heroicons-x-circle",showBars:!1};case"cancelled":return{text:"已取消",color:"text-(--ui-text-muted)",icon:"i-heroicons-no-symbol",showBars:!1};default:return{text:"未知",color:"text-(--ui-text-muted)",icon:"i-heroicons-question-mark-circle",showBars:!1}}}),c=T(()=>{const R=o.task.modelType,d=ze[R]||{label:R||"未知",color:"bg-gray-500/80"};return{label:d.label,type:R,color:d.color}}),y=T(()=>["pending","submitting","processing"].includes(o.task.status)),x=T(()=>{const R=o.task.modelType;return o.task.upstream?.estimatedTime??es[R]??ut}),S=k(Date.now());let D=null;he(y,R=>{R?(S.value=Date.now(),D=ft(()=>{S.value=Date.now()},ct)):D&&(clearInterval(D),D=null)},{immediate:!0}),Pe(()=>{D&&clearInterval(D)});const $=T(()=>{if(!y.value)return 0;const R=new Date(o.task.createdAt).getTime(),d=(S.value-R)/1e3,X=x.value*dt;return Math.min(d/X*100,100)}),q=T(()=>{if(!o.task.createdAt)return null;const R=new Date(o.task.createdAt).getTime(),d=o.task.status==="success"||o.task.status==="failed"?new Date(o.task.updatedAt).getTime():Date.now(),X=Math.floor((d-R)/1e3);if(X<60)return`${X}秒`;const w=Math.floor(X/60),b=X%60;return`${w}分${b}秒`}),F=k(!1);function B(){F.value=!0}function H(){F.value=!1,h("remove")}const L=k(!1),O=k(null);function V(){g(!I.value)}const M=T(()=>o.task.images&&o.task.images.length>0),W=k(!1),z=k(!1),ae=k(!1);function ie(){if(!o.task.resourceUrl)return;const R=document.createElement("a");R.href=o.task.resourceUrl,R.download=`video-${o.task.id}.mp4`,R.target="_blank",R.click()}return(R,d)=>{const X=Ne,w=be,b=pt,ee=Ce,Y=Ie,J=xt,A=gt,G=kt;return a(),m("div",oa,[t("div",na,[s.task.resourceUrl?(a(),m("video",{key:0,ref_key:"videoRef",ref:O,src:s.task.resourceUrl,class:Q(["w-full h-full object-contain cursor-pointer transition-all duration-300",e(I)?"blur-xl scale-105":""]),controls:"",preload:"metadata",onClick:Qe(V,["stop"])},null,10,ia)):(a(),m("div",ra,[t("div",ua,[e(r).showBars?(a(),j(X,{key:0,class:Q(["w-12 h-12 mb-2",e(r).color])},null,8,["class"])):e(r).icon?(a(),j(w,{key:1,name:e(r).icon,class:Q(["w-12 h-12 mb-2",e(r).color])},null,8,["name","class"])):v("",!0),t("p",{class:Q(["text-sm mb-2",e(r).color])},U(e(r).text),3),s.task.error?(a(),m("p",da,U(s.task.error),1)):v("",!0),s.task.error&&s.task.status==="failed"?(a(),m("button",{key:3,class:"text-xs text-(--ui-text-muted) hover:text-(--ui-text) underline underline-offset-2",onClick:d[0]||(d[0]=f=>z.value=!0)}," 查看详情 ")):v("",!0)])])),["pending","submitting","processing"].includes(s.task.status)?(a(),m("div",ca,[t("button",{class:"bg-black/50 backdrop-blur-sm rounded-lg px-4 py-2 text-white/80 text-sm hover:bg-(--ui-warning)/70 transition-colors",onClick:d[1]||(d[1]=f=>h("cancel"))},[l(w,{name:"i-heroicons-stop",class:"w-4 h-4 inline mr-1"}),d[14]||(d[14]=te(" 取消任务 ",-1))])])):v("",!0),s.task.resourceUrl&&s.task.status!=="success"?(a(),m("div",ma,[t("span",{class:Q(["text-xs",e(r).color])},U(e(r).text),3)])):v("",!0),t("div",pa,[s.task.resourceUrl?(a(),m("button",{key:0,class:"w-8 h-8 flex items-center justify-center rounded-full bg-black/50 backdrop-blur-sm hover:bg-black/70 transition-colors",title:"下载视频",onClick:ie},[l(w,{name:"i-heroicons-arrow-down-tray",class:"w-4 h-4 text-white"})])):v("",!0),s.task.resourceUrl?(a(),m("button",{key:1,class:"w-8 h-8 flex items-center justify-center rounded-full bg-black/50 backdrop-blur-sm hover:bg-black/70 transition-colors",title:"全屏查看",onClick:d[2]||(d[2]=f=>L.value=!0)},[l(w,{name:"i-heroicons-arrows-pointing-out",class:"w-4 h-4 text-white"})])):v("",!0),s.task.status==="failed"||s.task.status==="cancelled"?(a(),m("button",{key:2,class:"w-8 h-8 flex items-center justify-center rounded-full bg-black/50 backdrop-blur-sm hover:bg-black/70 transition-colors",title:"重试",onClick:d[3]||(d[3]=f=>h("retry"))},[l(w,{name:"i-heroicons-arrow-path",class:"w-4 h-4 text-white"})])):v("",!0),t("button",{class:"w-8 h-8 flex items-center justify-center rounded-full bg-black/50 backdrop-blur-sm hover:bg-black/70 transition-colors",title:"详情",onClick:d[4]||(d[4]=f=>W.value=!0)},[l(w,{name:"i-heroicons-information-circle",class:"w-4 h-4 text-white"})]),t("button",{class:"w-8 h-8 flex items-center justify-center rounded-full bg-black/50 backdrop-blur-sm hover:bg-black/70 transition-colors",title:"复制到工作台",onClick:d[5]||(d[5]=f=>h("copyToPanel",s.task.prompt,s.task.images))},[l(w,{name:"i-heroicons-document-duplicate",class:"w-4 h-4 text-white"})]),t("button",{class:"w-8 h-8 flex items-center justify-center rounded-full bg-black/50 backdrop-blur-sm hover:bg-(--ui-error)/70 transition-colors",title:"删除",onClick:B},[l(w,{name:"i-heroicons-trash",class:"w-4 h-4 text-white"})])]),t("div",fa,[t("div",{class:Q(["px-2 py-1 rounded-full text-xs text-white font-medium",e(c).color])},U(e(c).label),3),t("div",va,[l(w,{name:"i-heroicons-video-camera",class:"w-3 h-3 inline mr-0.5"}),d[15]||(d[15]=te(" 视频 ",-1))])]),e(M)?(a(),m("button",{key:4,class:"absolute bottom-2 right-2 px-2 py-1 rounded-full text-xs text-white font-medium bg-black/60 backdrop-blur-sm hover:bg-black/80 transition-colors flex items-center gap-1",title:"查看参考图",onClick:d[6]||(d[6]=f=>ae.value=!0)},[l(w,{name:"i-heroicons-photo",class:"w-3.5 h-3.5"}),d[16]||(d[16]=t("span",null,"参考图",-1))])):v("",!0),e(y)?(a(),m("div",ba,[t("div",{class:"h-full transition-all duration-500 ease-out animate-shimmer",style:lt({width:`${e($)}%`,backgroundImage:"linear-gradient(90deg, #8b5cf6, #ec4899, #06b6d4, #8b5cf6)",backgroundSize:"200% 100%"})},null,4)])):v("",!0)]),t("div",xa,[t("div",ga,[t("div",ka,[t("span",{class:"font-mono bg-(--ui-bg-accented) px-1.5 py-0.5 rounded cursor-pointer hover:bg-(--ui-bg-inverted)/20 select-none",title:"点击复制",onClick:_},"ID:"+U(s.task.id),1),l(b,{time:s.task.createdAt},null,8,["time"])]),e(q)?(a(),m("span",ya,"耗时 "+U(e(q)),1)):v("",!0)]),t("p",{class:"text-(--ui-text-muted) text-sm line-clamp-2",title:s.task.prompt??""},[d[17]||(d[17]=t("span",{class:"text-(--ui-text-dimmed)"},"提示词：",-1)),te(U(s.task.prompt||"无"),1)],8,ha)]),l(Y,{open:e(F),"onUpdate:open":d[8]||(d[8]=f=>E(F)?F.value=f:null),title:"确认删除",description:"确定要删除这个任务吗？此操作不可撤销。",close:!1},{footer:p(()=>[t("div",wa,[l(ee,{color:"error",onClick:H},{default:p(()=>[...d[18]||(d[18]=[te("删除",-1)])]),_:1}),l(ee,{variant:"outline",color:"neutral",onClick:d[7]||(d[7]=f=>F.value=!1)},{default:p(()=>[...d[19]||(d[19]=[te("取消",-1)])]),_:1})])]),_:1},8,["open"]),l(J,{open:e(W),"onUpdate:open":d[9]||(d[9]=f=>E(W)?W.value=f:null),task:s.task},null,8,["open","task"]),l(Y,{open:e(L),"onUpdate:open":d[11]||(d[11]=f=>E(L)?L.value=f:null),ui:{content:"sm:max-w-4xl"}},{content:p(()=>[t("div",_a,[s.task.resourceUrl?(a(),m("video",{key:0,src:s.task.resourceUrl,class:"max-h-[85vh] w-full",controls:"",autoplay:""},null,8,$a)):v("",!0),t("button",{class:"absolute top-3 right-3 w-9 h-9 flex items-center justify-center rounded-full bg-black/50 backdrop-blur-sm hover:bg-black/70 transition-colors",onClick:d[10]||(d[10]=f=>L.value=!1)},[l(w,{name:"i-heroicons-x-mark",class:"w-5 h-5 text-white"})]),t("button",{class:"absolute top-3 left-3 w-9 h-9 flex items-center justify-center rounded-full bg-black/50 backdrop-blur-sm hover:bg-black/70 transition-colors",title:"下载视频",onClick:ie},[l(w,{name:"i-heroicons-arrow-down-tray",class:"w-5 h-5 text-white"})])])]),_:1},8,["open"]),l(A,{open:e(ae),"onUpdate:open":d[12]||(d[12]=f=>E(ae)?ae.value=f:null),images:s.task.images},null,8,["open","images"]),l(G,{open:e(z),"onUpdate:open":d[13]||(d[13]=f=>E(z)?z.value=f:null),"task-id":s.task.id},null,8,["open","task-id"])])}}}),Ta=Object.assign(Ia,{__name:"StudioVideoCard"}),Ca={class:"bg-(--ui-bg-elevated) backdrop-blur-sm rounded-lg border border-(--ui-border) overflow-hidden"},Sa=["src","alt"],Ua={key:1,class:"w-full h-full flex items-center justify-center p-4"},Va={class:"text-center"},Ma={key:2,class:"text-(--ui-error) text-xs leading-relaxed line-clamp-3 px-2 mb-2"},Aa={key:2,class:"absolute bottom-16 left-0 right-0 flex justify-center"},Ra={key:3,class:"absolute top-2 right-2 px-2 py-1 rounded-full bg-black/50 backdrop-blur-sm"},Da={class:"absolute top-2 left-2 flex gap-1"},Ea=["disabled"],Ba={key:5,class:"absolute bottom-0 left-0 right-0 h-[3px] bg-black/20 overflow-hidden"},Oa={class:"p-4"},ja={class:"flex items-center justify-between text-(--ui-text-dimmed) text-xs mb-2"},qa={class:"flex items-center gap-2"},Pa={key:0},Fa=["title"],La={class:"flex justify-end gap-3"},za={class:"relative bg-(--ui-bg) flex items-center justify-center"},Na=["src","alt"],Wa=ce({__name:"Card",props:{task:{}},emits:["action","remove","retry","cancel","blur","copyToPanel"],setup(s,{emit:C}){const o=s,h=C,u=k(!1),_=$e();async function I(){const w=String(o.task.id);try{await navigator.clipboard.writeText(w),_.add({title:"已复制",description:`ID:${w}`,color:"success"})}catch{const b=document.createElement("textarea");b.value=w,document.body.appendChild(b),b.select(),document.execCommand("copy"),document.body.removeChild(b),_.add({title:"已复制",description:`ID:${w}`,color:"success"})}}const g=k(o.task.isBlurred??!0);he(()=>o.task.isBlurred,w=>{w!==void 0&&(g.value=w)});async function r(w){g.value=w,h("blur",w);try{await $fetch(`/api/tasks/${o.task.id}/blur`,{method:"PATCH",body:{isBlurred:w}})}catch(b){console.error("保存模糊状态失败:",b)}}const c=T(()=>{switch(o.task.status){case"pending":return{text:"等待中",color:"text-(--ui-warning)",icon:"i-heroicons-clock",showBars:!1};case"submitting":return{text:"提交中",color:"text-(--ui-info)",icon:null,showBars:!0};case"processing":return{text:o.task.progress||"生成中",color:"text-(--ui-primary)",icon:null,showBars:!0};case"success":return{text:"已完成",color:"text-(--ui-success)",icon:"i-heroicons-check-circle",showBars:!1};case"failed":return{text:"失败",color:"text-(--ui-error)",icon:"i-heroicons-x-circle",showBars:!1};case"cancelled":return{text:"已取消",color:"text-(--ui-text-muted)",icon:"i-heroicons-no-symbol",showBars:!1};default:return{text:"未知",color:"text-(--ui-text-muted)",icon:"i-heroicons-question-mark-circle",showBars:!1}}}),y=T(()=>{const w=o.task.modelType,b=ze[w]||{label:w||"未知",color:"bg-gray-500/80"};return{label:b.label,type:w,color:b.color}}),x=T(()=>["pending","submitting","processing"].includes(o.task.status)),S=T(()=>o.task.upstream?.estimatedTime??ut),D=k(Date.now());let $=null;he(x,w=>{w?(D.value=Date.now(),$=ft(()=>{D.value=Date.now()},ct)):$&&(clearInterval($),$=null)},{immediate:!0}),Pe(()=>{$&&clearInterval($)});const q=T(()=>{if(!x.value)return 0;const w=new Date(o.task.createdAt).getTime(),b=(D.value-w)/1e3,ee=S.value*dt;return Math.min(b/ee*100,100)}),F=T(()=>{if(!o.task.createdAt)return null;const w=new Date(o.task.createdAt).getTime(),b=o.task.status==="success"||o.task.status==="failed"?new Date(o.task.updatedAt).getTime():Date.now(),ee=Math.floor((b-w)/1e3);if(ee<60)return`${ee}秒`;const Y=Math.floor(ee/60),J=ee%60;return`${Y}分${J}秒`}),B=T(()=>o.task.buttons??[]),H=T(()=>{const w=[],b=B.value.filter(J=>J.label.startsWith("U"));b.length>0&&w.push([{label:"放大",type:"label"},...b.map(J=>({label:J.label,icon:"i-heroicons-arrows-pointing-out",onSelect:()=>L(J.customId)}))]);const ee=B.value.filter(J=>J.label.startsWith("V"));ee.length>0&&w.push([{label:"变体",type:"label"},...ee.map(J=>({label:J.label,icon:"i-heroicons-sparkles",onSelect:()=>L(J.customId)}))]);const Y=B.value.find(J=>J.emoji==="🔄");return Y&&w.push([{label:"重绘",icon:"i-heroicons-arrow-path",onSelect:()=>L(Y.customId)}]),w});async function L(w){u.value=!0;try{h("action",w)}finally{u.value=!1}}const O=k(!1);function V(){O.value=!0}function M(){O.value=!1,h("remove")}const W=k(!1);function z(){r(!g.value)}const ae=T(()=>o.task.images&&o.task.images.length>0),ie=k(!1),R=k(!1),d=k(!1);function X(){if(!o.task.resourceUrl)return;const w=document.createElement("a");w.href=o.task.resourceUrl,w.download=`mj-${o.task.id}.png`,w.target="_blank",w.click()}return(w,b)=>{const ee=Ne,Y=be,J=ts,A=pt,G=Ce,f=Ie,oe=xt,ue=gt,ne=kt;return a(),m("div",Ca,[t("div",{class:Q(["aspect-square relative",s.task.resourceUrl&&!e(g)?"checkerboard-bg":"bg-(--ui-bg-muted)"])},[s.task.resourceUrl?(a(),m("img",{key:0,src:s.task.resourceUrl,alt:s.task.prompt??"",class:Q(["w-full h-full object-contain cursor-pointer transition-all duration-300",e(g)?"blur-xl scale-105":""]),onClick:z},null,10,Sa)):(a(),m("div",Ua,[t("div",Va,[e(c).showBars?(a(),j(ee,{key:0,class:Q(["w-12 h-12 mb-2",e(c).color])},null,8,["class"])):e(c).icon?(a(),j(Y,{key:1,name:e(c).icon,class:Q(["w-12 h-12 mb-2",e(c).color])},null,8,["name","class"])):v("",!0),t("p",{class:Q(["text-sm mb-2",e(c).color])},U(e(c).text),3),s.task.error?(a(),m("p",Ma,U(s.task.error),1)):v("",!0),s.task.error&&s.task.status==="failed"?(a(),m("button",{key:3,class:"text-xs text-(--ui-text-muted) hover:text-(--ui-text) underline underline-offset-2",onClick:b[0]||(b[0]=i=>R.value=!0)}," 查看详情 ")):v("",!0)])])),["pending","submitting","processing"].includes(s.task.status)?(a(),m("div",Aa,[t("button",{class:"bg-black/50 backdrop-blur-sm rounded-lg px-4 py-2 text-white/80 text-sm hover:bg-(--ui-warning)/70 transition-colors",onClick:b[1]||(b[1]=i=>h("cancel"))},[l(Y,{name:"i-heroicons-stop",class:"w-4 h-4 inline mr-1"}),b[14]||(b[14]=te(" 取消任务 ",-1))])])):v("",!0),s.task.resourceUrl&&s.task.status!=="success"?(a(),m("div",Ra,[t("span",{class:Q(["text-xs",e(c).color])},U(e(c).text),3)])):v("",!0),t("div",Da,[s.task.resourceUrl?(a(),m("button",{key:0,class:"w-8 h-8 flex items-center justify-center rounded-full bg-black/50 backdrop-blur-sm hover:bg-black/70 transition-colors",title:"下载图片",onClick:X},[l(Y,{name:"i-heroicons-arrow-down-tray",class:"w-4 h-4 text-white"})])):v("",!0),s.task.resourceUrl?(a(),m("button",{key:1,class:"w-8 h-8 flex items-center justify-center rounded-full bg-black/50 backdrop-blur-sm hover:bg-black/70 transition-colors",title:"放大查看",onClick:b[2]||(b[2]=i=>W.value=!0)},[l(Y,{name:"i-heroicons-magnifying-glass-plus",class:"w-4 h-4 text-white"})])):v("",!0),e(y).type==="midjourney"&&e(B).length>0?(a(),j(J,{key:2,items:e(H)},{default:p(()=>[t("button",{class:"w-8 h-8 flex items-center justify-center rounded-full bg-black/50 backdrop-blur-sm hover:bg-black/70 transition-colors",title:"MJ操作",disabled:e(u)},[l(Y,{name:"i-heroicons-squares-plus",class:"w-4 h-4 text-white"})],8,Ea)]),_:1},8,["items"])):v("",!0),s.task.status==="failed"||s.task.status==="cancelled"?(a(),m("button",{key:3,class:"w-8 h-8 flex items-center justify-center rounded-full bg-black/50 backdrop-blur-sm hover:bg-black/70 transition-colors",title:"重试",onClick:b[3]||(b[3]=i=>h("retry"))},[l(Y,{name:"i-heroicons-arrow-path",class:"w-4 h-4 text-white"})])):v("",!0),t("button",{class:"w-8 h-8 flex items-center justify-center rounded-full bg-black/50 backdrop-blur-sm hover:bg-black/70 transition-colors",title:"详情",onClick:b[4]||(b[4]=i=>ie.value=!0)},[l(Y,{name:"i-heroicons-information-circle",class:"w-4 h-4 text-white"})]),t("button",{class:"w-8 h-8 flex items-center justify-center rounded-full bg-black/50 backdrop-blur-sm hover:bg-black/70 transition-colors",title:"复制到工作台",onClick:b[5]||(b[5]=i=>h("copyToPanel",s.task.prompt,s.task.modelParams,s.task.images))},[l(Y,{name:"i-heroicons-document-duplicate",class:"w-4 h-4 text-white"})]),t("button",{class:"w-8 h-8 flex items-center justify-center rounded-full bg-black/50 backdrop-blur-sm hover:bg-(--ui-error)/70 transition-colors",title:"删除",onClick:V},[l(Y,{name:"i-heroicons-trash",class:"w-4 h-4 text-white"})])]),t("div",{class:Q(["absolute bottom-2 left-2 px-2 py-1 rounded-full text-xs text-white font-medium",e(y).color])},U(e(y).label),3),e(ae)?(a(),m("button",{key:4,class:"absolute bottom-2 right-2 px-2 py-1 rounded-full text-xs text-white font-medium bg-black/60 backdrop-blur-sm hover:bg-black/80 transition-colors flex items-center gap-1",title:"查看参考图",onClick:b[6]||(b[6]=i=>d.value=!0)},[l(Y,{name:"i-heroicons-photo",class:"w-3.5 h-3.5"}),t("span",null,"参考图 "+U(s.task.images.length),1)])):v("",!0),e(x)?(a(),m("div",Ba,[t("div",{class:"h-full transition-all duration-500 ease-out animate-shimmer",style:lt({width:`${e(q)}%`,backgroundImage:"linear-gradient(90deg, #8b5cf6, #ec4899, #06b6d4, #8b5cf6)",backgroundSize:"200% 100%"})},null,4)])):v("",!0)],2),t("div",Oa,[t("div",ja,[t("div",qa,[t("span",{class:"font-mono bg-(--ui-bg-accented) px-1.5 py-0.5 rounded cursor-pointer hover:bg-(--ui-bg-inverted)/20 select-none",title:"点击复制",onClick:I},"ID:"+U(s.task.id),1),l(A,{time:s.task.createdAt},null,8,["time"])]),e(F)?(a(),m("span",Pa,"耗时 "+U(e(F)),1)):v("",!0)]),t("p",{class:"text-(--ui-text-muted) text-sm line-clamp-2 mb-3",title:s.task.prompt??""},[b[15]||(b[15]=t("span",{class:"text-(--ui-text-dimmed)"},"提示词：",-1)),te(U(s.task.prompt||"图片混合"),1)],8,Fa)]),l(f,{open:e(O),"onUpdate:open":b[8]||(b[8]=i=>E(O)?O.value=i:null),title:"确认删除",description:"确定要删除这个任务吗？此操作不可撤销。",close:!1},{footer:p(()=>[t("div",La,[l(G,{color:"error",onClick:M},{default:p(()=>[...b[16]||(b[16]=[te("删除",-1)])]),_:1}),l(G,{variant:"outline",color:"neutral",onClick:b[7]||(b[7]=i=>O.value=!1)},{default:p(()=>[...b[17]||(b[17]=[te("取消",-1)])]),_:1})])]),_:1},8,["open"]),l(oe,{open:e(ie),"onUpdate:open":b[9]||(b[9]=i=>E(ie)?ie.value=i:null),task:s.task},null,8,["open","task"]),l(f,{open:e(W),"onUpdate:open":b[11]||(b[11]=i=>E(W)?W.value=i:null),ui:{content:"sm:max-w-4xl"}},{content:p(()=>[t("div",za,[s.task.resourceUrl?(a(),m("img",{key:0,src:s.task.resourceUrl,alt:s.task.prompt??"",class:"max-h-[85vh]"},null,8,Na)):v("",!0),t("button",{class:"absolute top-3 right-3 w-9 h-9 flex items-center justify-center rounded-full bg-black/50 backdrop-blur-sm hover:bg-black/70 transition-colors",onClick:b[10]||(b[10]=i=>W.value=!1)},[l(Y,{name:"i-heroicons-x-mark",class:"w-5 h-5 text-white"})]),t("button",{class:"absolute top-3 left-3 w-9 h-9 flex items-center justify-center rounded-full bg-black/50 backdrop-blur-sm hover:bg-black/70 transition-colors",title:"下载图片",onClick:X},[l(Y,{name:"i-heroicons-arrow-down-tray",class:"w-5 h-5 text-white"})])])]),_:1},8,["open"]),l(ue,{open:e(d),"onUpdate:open":b[12]||(b[12]=i=>E(d)?d.value=i:null),images:s.task.images},null,8,["open","images"]),l(ne,{open:e(R),"onUpdate:open":b[13]||(b[13]=i=>E(R)?R.value=i:null),"task-id":s.task.id},null,8,["open","task-id"])])}}}),Ga=Object.assign(Ot(Wa,[["__scopeId","data-v-f4b536ad"]]),{__name:"StudioCard"});function yt(){const s=ye("tasks",()=>[]),C=ye("tasks-loading",()=>!1),o=ye("tasks-page",()=>1),h=ye("tasks-pageSize",()=>20),u=ye("tasks-total",()=>0),_=ye("tasks-sourceType",()=>"workbench"),I=ye("tasks-taskType",()=>"all"),g=ye("tasks-keyword",()=>""),{on:r}=jt();async function c(V){C.value=!0,V!==void 0&&(o.value=V);try{const M=await $fetch("/api/tasks",{query:{page:o.value,pageSize:h.value,sourceType:_.value,taskType:I.value!=="all"?I.value:void 0,keyword:g.value||void 0}});s.value=M.tasks,u.value=M.total}catch(M){console.error("加载任务列表失败:",M)}finally{C.value=!1}}async function y(V,M){try{await $fetch("/api/tasks/action",{method:"POST",body:{taskId:V.id,customId:M}})}catch(W){throw console.error("执行动作失败:",W),W}}async function x(V){await $fetch(`/api/tasks/${V}`,{method:"DELETE"})}async function S(V,M){await $fetch("/api/tasks/blur-batch",{method:"PATCH",body:{isBlurred:V,taskIds:M}})}async function D(V){try{await $fetch(`/api/tasks/${V}/retry`,{method:"POST"})}catch(M){throw console.error("重试任务失败:",M),M}}async function $(V){try{await $fetch(`/api/tasks/${V}/cancel`,{method:"POST"})}catch(M){throw console.error("取消任务失败:",M),M}}function q(V){const{task:M}=V;s.value.some(z=>z.id===M.id)||o.value===1&&$fetch(`/api/tasks/${M.id}`).then(z=>{s.value.some(ie=>ie.id===M.id)||(s.value.unshift(z),u.value+=1)}).catch(z=>{console.error("[useTasks] 获取新任务详情失败:",z)})}function F(V){const{taskId:M,status:W,progress:z,resourceUrl:ae,error:ie,buttons:R}=V,d=s.value.findIndex(w=>w.id===M);if(d<0)return;const X=s.value[d];s.value[d]={...X,status:W,progress:z!==void 0?`${z}%`:X.progress,resourceUrl:ae??X.resourceUrl,error:ie??X.error,buttons:R??X.buttons}}function B(V){const{taskId:M}=V,W=s.value.findIndex(z=>z.id===M);W>=0&&(s.value.splice(W,1),u.value=Math.max(0,u.value-1))}function H(V){const{taskId:M}=V;o.value===1&&c(1)}function L(V){const{taskId:M,isBlurred:W}=V,z=s.value.findIndex(ae=>ae.id===M);if(z>=0){const ae=s.value[z];s.value[z]={...ae,isBlurred:W}}}function O(V){const{taskIds:M,isBlurred:W}=V;M.length===0?s.value=s.value.map(z=>({...z,isBlurred:W})):s.value=s.value.map(z=>M.includes(z.id)?{...z,isBlurred:W}:z)}return r("task.created",q),r("task.status.updated",F),r("task.deleted",B),r("task.restored",H),r("task.blur.updated",L),r("tasks.blur.updated",O),{tasks:s,isLoading:C,currentPage:o,pageSize:h,total:u,sourceType:_,taskType:I,keyword:g,loadTasks:c,executeAction:y,deleteTask:x,batchBlur:S,retryTask:D,cancelTask:$}}const Ha={class:"space-y-4"},Ka={class:"flex items-center justify-between"},Za={class:"flex items-center gap-3"},Ja={key:0,class:"flex items-center gap-1"},Ya={class:"text-(--ui-text-dimmed) text-sm"},Qa={class:"flex flex-wrap items-center gap-3"},Xa={key:0,class:"text-center py-12"},eo={key:1,class:"text-center py-12"},to={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"},so={key:0,class:"flex justify-center mt-6"},lo=ce({__name:"List",emits:["copyToPanel"],setup(s,{emit:C}){const o=C,h=$e(),{tasks:u,isLoading:_,currentPage:I,pageSize:g,total:r,sourceType:c,taskType:y,keyword:x,executeAction:S,deleteTask:D,batchBlur:$,retryTask:q,cancelTask:F,loadTasks:B}=yt(),H=k(!1),L=[{label:"绘图工作台",value:"workbench"},{label:"对话插图",value:"chat"},{label:"全部",value:"all"}],O=[{label:"全部",value:"all"},{label:"图片",value:"image"},{label:"视频",value:"video"}],V=k(x.value);let M=null;function W(){M&&clearTimeout(M),M=setTimeout(()=>{x.value=V.value,I.value=1,B()},300)}function z(){I.value=1,B()}function ae(){I.value=1,B()}const ie=T(()=>Math.ceil(r.value/g.value));async function R(G,f){const oe=u.value.find(ue=>ue.id===G);if(oe)try{await S(oe,f)}catch(ue){h.add({title:ue.message||"执行失败",color:"error"})}}async function d(G){try{await q(G)}catch(f){h.add({title:f.data?.message||f.message||"重试失败",color:"error"})}}async function X(G){try{await F(G)}catch(f){h.add({title:f.data?.message||f.message||"取消失败",color:"error"})}}async function w(G){try{await D(G)}catch(f){h.add({title:f.data?.message||f.message||"删除失败",color:"error"})}}function b(G,f){const oe=u.value.findIndex(ue=>ue.id===G);oe>=0&&(u.value[oe]={...u.value[oe],isBlurred:f})}function ee(){return u.value.filter(G=>G.resourceUrl).map(G=>G.id)}async function Y(){H.value=!0;try{await $(!0,ee())}catch(G){h.add({title:G.data?.message||G.message||"操作失败",color:"error"})}finally{H.value=!1}}async function J(){H.value=!0;try{await $(!1,ee())}catch(G){h.add({title:G.data?.message||G.message||"操作失败",color:"error"})}finally{H.value=!1}}function A(){B()}return(G,f)=>{const oe=be,ue=Ce,ne=st,i=qt,me=Fe,fe=Ta,le=Ga,ge=ss;return a(),m("div",Ha,[t("div",Ka,[f[9]||(f[9]=t("h2",{class:"text-(--ui-text) text-lg font-medium"},"生成任务",-1)),t("div",Za,[e(u).some(K=>K.resourceUrl)?(a(),m("div",Ja,[l(ue,{size:"xs",variant:"ghost",color:"neutral",loading:e(H),disabled:e(H),onClick:Y},{default:p(()=>[l(oe,{name:"i-heroicons-eye-slash",class:"w-4 h-4 lg:mr-1"}),f[6]||(f[6]=t("span",{class:"hidden lg:inline"},"模糊本页",-1))]),_:1},8,["loading","disabled"]),l(ue,{size:"xs",variant:"ghost",color:"neutral",loading:e(H),disabled:e(H),onClick:J},{default:p(()=>[l(oe,{name:"i-heroicons-eye",class:"w-4 h-4 lg:mr-1"}),f[7]||(f[7]=t("span",{class:"hidden lg:inline"},"显示本页",-1))]),_:1},8,["loading","disabled"])])):v("",!0),l(ne,{to:"/trash"},{default:p(()=>[l(ue,{size:"xs",variant:"ghost",color:"neutral"},{default:p(()=>[l(oe,{name:"i-heroicons-trash",class:"w-4 h-4 lg:mr-1"}),f[8]||(f[8]=t("span",{class:"hidden lg:inline"},"回收站",-1))]),_:1})]),_:1}),t("span",Ya,"共 "+U(e(r))+" 个任务",1)])]),t("div",Qa,[l(i,{modelValue:e(c),"onUpdate:modelValue":[f[0]||(f[0]=K=>E(c)?c.value=K:null),z],items:L,"value-key":"value",class:"w-32",size:"sm"},null,8,["modelValue"]),l(i,{modelValue:e(y),"onUpdate:modelValue":[f[1]||(f[1]=K=>E(y)?y.value=K:null),ae],items:O,"value-key":"value",class:"w-24",size:"sm"},null,8,["modelValue"]),l(me,{modelValue:e(V),"onUpdate:modelValue":f[2]||(f[2]=K=>E(V)?V.value=K:null),placeholder:"搜索提示词...",size:"sm",class:"w-48",ui:{leading:"pl-2.5"},onInput:W},{leading:p(()=>[l(oe,{name:"i-heroicons-magnifying-glass",class:"w-4 h-4 text-(--ui-text-muted)"})]),_:1},8,["modelValue"])]),e(_)?(a(),m("div",Xa,[l(oe,{name:"i-heroicons-arrow-path",class:"w-8 h-8 text-(--ui-text-dimmed) mx-auto mb-2 animate-spin"}),f[10]||(f[10]=t("p",{class:"text-(--ui-text-dimmed)"},"加载中...",-1))])):e(u).length===0?(a(),m("div",eo,[l(oe,{name:"i-heroicons-photo",class:"w-16 h-16 text-(--ui-text-dimmed)/50 mx-auto mb-4"}),f[11]||(f[11]=t("p",{class:"text-(--ui-text-dimmed)"},"还没有生成任务",-1)),f[12]||(f[12]=t("p",{class:"text-(--ui-text-dimmed)/70 text-sm mt-1"},"输入提示词开始创作",-1))])):(a(),m(ve,{key:2},[t("div",to,[(a(!0),m(ve,null,Ae(e(u),K=>(a(),m(ve,{key:K.id},[K.taskType==="video"?(a(),j(fe,{key:0,task:K,onRemove:se=>w(K.id),onRetry:se=>d(K.id),onCancel:se=>X(K.id),onBlur:se=>b(K.id,se),onCopyToPanel:f[3]||(f[3]=(se,de)=>o("copyToPanel",se,null,de))},null,8,["task","onRemove","onRetry","onCancel","onBlur"])):(a(),j(le,{key:1,task:K,onAction:se=>R(K.id,se),onRemove:se=>w(K.id),onRetry:se=>d(K.id),onCancel:se=>X(K.id),onBlur:se=>b(K.id,se),onCopyToPanel:f[4]||(f[4]=(se,de,ke)=>o("copyToPanel",se,de,ke))},null,8,["task","onAction","onRemove","onRetry","onCancel","onBlur"]))],64))),128))]),e(ie)>1?(a(),m("div",so,[l(ge,{page:e(I),"onUpdate:page":[f[5]||(f[5]=K=>E(I)?I.value=K:null),A],total:e(r),"items-per-page":e(g)},null,8,["page","total","items-per-page"])])):v("",!0)],64))])}}}),ao=Object.assign(lo,{__name:"StudioList"}),oo={class:"h-[calc(100vh-3.5rem)] flex flex-col overflow-y-auto lg:flex-row lg:overflow-hidden"},no={class:"flex-shrink-0 border-b lg:border-b-0 lg:border-r border-(--ui-border) bg-(--ui-bg-elevated) p-4 lg:w-[340px] lg:overflow-y-auto"},io={class:"flex-1 p-4 lg:overflow-y-auto"},Mo=ce({__name:"studio",setup(s){const{loadTasks:C}=yt(),{upstreams:o,loadUpstreams:h}=ls(),u=$e(),_=k(null);Be(()=>{C(),h()});async function I(c){try{const y=await $fetch("/api/tasks",{method:"POST",body:{taskType:"image",prompt:c.prompt,modelParams:c.modelParams,images:c.images,type:c.apiFormat==="mj-proxy"&&c.images.length>0&&!c.prompt?"blend":"imagine",upstreamId:c.upstreamId,aimodelId:c.aimodelId,modelType:c.modelType,apiFormat:c.apiFormat,modelName:c.modelName}});y.success&&u.add({title:"任务已创建",description:y.message,color:"success"})}catch(y){u.add({title:"提交失败",description:y.data?.message||y.message||"请稍后重试",color:"error"})}}async function g(c){try{const y=await $fetch("/api/tasks",{method:"POST",body:{taskType:"video",prompt:c.prompt,modelParams:c.modelParams,images:c.images,upstreamId:c.upstreamId,aimodelId:c.aimodelId,modelType:c.modelType,apiFormat:c.apiFormat,modelName:c.modelName}});y.success&&u.add({title:"视频任务已创建",description:y.message,color:"success"})}catch(y){u.add({title:"提交失败",description:y.data?.message||y.message||"请稍后重试",color:"error"})}}function r(c,y,x){_.value?.setContent(c,y,x),u.add({title:"已复制到工作台",color:"success"})}return Pe(()=>{cleanup()}),(c,y)=>{const x=fl,S=ao;return a(),m("div",oo,[t("div",no,[l(x,{ref_key:"workbenchRef",ref:_,upstreams:e(o),onSubmitImage:I,onSubmitVideo:g},null,8,["upstreams"])]),t("div",io,[l(S,{onCopyToPanel:r})])])}}});export{Mo as default};
