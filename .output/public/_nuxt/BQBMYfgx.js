import{f as H,R as F,O as Z,m as R,g as m,q as $,i as Y,w as b,o as p,a as s,c as E,b as n,z as X,j as i,d as _,k as q,y as I,F as P,t as L}from"./DZ_1_TWT.js";import{_ as J}from"./DujSY10F.js";import{_ as Q}from"./CPI9yk3n.js";import{_ as ee}from"./BOxYQfEP.js";import{_ as te}from"./Ptiozo9H.js";import{U as o}from"./Cl2C_jUo.js";import{u as se}from"./BgmUBLD9.js";import{u as ie}from"./CJsX1qrP.js";import"./DASMixbo.js";import"./BKT0n4s3.js";import"./CHEUhdok.js";import"./D41R7u62.js";import"./uQ15kqef.js";import"./DDAgXY8S.js";import"./DTXzf-yb.js";import"./2BvrFYEm.js";const oe={class:"mb-4 flex items-center justify-between"},ae={key:0,class:"text-center py-12"},le={key:1,class:"space-y-4"},de={class:"bg-(--ui-bg-elevated) rounded-lg p-6 border border-(--ui-border)"},ne={class:"space-y-4"},me={class:"flex items-center justify-between cursor-pointer"},re={class:"flex items-center justify-between"},ue={class:"flex items-center justify-between"},pe={class:"flex items-center justify-between"},_e={class:"bg-(--ui-bg-elevated) rounded-lg p-6 border border-(--ui-border)"},Ie={class:"space-y-3"},ce={class:"flex items-center justify-between gap-4"},xe={class:"min-w-0"},Ee={class:"text-xs text-(--ui-text-muted) mt-1 break-all"},Ae={class:"flex items-center gap-2"},ge={class:"bg-(--ui-bg-elevated) rounded-lg p-4 border border-(--ui-border)"},be={class:"space-y-4"},fe={class:"flex items-center justify-between"},ve={class:"flex items-center justify-between"},Ue={class:"flex items-center justify-between"},he=H({__name:"general",setup(De){const{settings:d,isLoading:T,isLoaded:k,loadSettings:C,updateSettings:f}=se(),{upstreams:A,loadUpstreams:z}=ie(),r=F(),e=Z({blurByDefault:!0,compressKeepCount:4,titleMaxLength:30,suggestionsCount:5,imageSavePath:"",aiOptimizeUpstreamId:0,aiOptimizeAimodelId:0,aiOptimizeModelName:"",embeddedUpstreamId:0,embeddedAimodelId:0,workbenchUpstreamId:0,workbenchAimodelId:0}),v=R(!1),u=R(!1),g=R(null),G=m(()=>!!window.electronAPI);$(async()=>{if(await Promise.all([k.value?Promise.resolve():C(),z()]),B(),window.electronAPI?.getPaths)try{g.value=await window.electronAPI.getPaths()}catch{g.value=null}});function B(){e.blurByDefault=d.value[o.GENERAL_BLUR_BY_DEFAULT]??!0,e.compressKeepCount=d.value[o.GENERAL_COMPRESS_KEEP_COUNT]??4,e.titleMaxLength=d.value[o.GENERAL_TITLE_MAX_LENGTH]??30,e.suggestionsCount=d.value[o.GENERAL_SUGGESTIONS_COUNT]??5,e.imageSavePath=d.value[o.GENERAL_IMAGE_SAVE_PATH]??"",e.aiOptimizeUpstreamId=d.value[o.DRAWING_AI_OPTIMIZE_UPSTREAM_ID]??0,e.aiOptimizeAimodelId=d.value[o.DRAWING_AI_OPTIMIZE_AIMODEL_ID]??0,e.aiOptimizeModelName=d.value[o.DRAWING_AI_OPTIMIZE_MODEL_NAME]??"",e.embeddedUpstreamId=d.value[o.DRAWING_EMBEDDED_UPSTREAM_ID]??0,e.embeddedAimodelId=d.value[o.DRAWING_EMBEDDED_AIMODEL_ID]??0,e.workbenchUpstreamId=d.value[o.DRAWING_WORKBENCH_UPSTREAM_ID]??0,e.workbenchAimodelId=d.value[o.DRAWING_WORKBENCH_AIMODEL_ID]??0}async function V(){v.value=!0;try{await f({[o.GENERAL_BLUR_BY_DEFAULT]:e.blurByDefault,[o.GENERAL_COMPRESS_KEEP_COUNT]:e.compressKeepCount,[o.GENERAL_TITLE_MAX_LENGTH]:e.titleMaxLength,[o.GENERAL_SUGGESTIONS_COUNT]:e.suggestionsCount,[o.GENERAL_IMAGE_SAVE_PATH]:e.imageSavePath,[o.DRAWING_AI_OPTIMIZE_UPSTREAM_ID]:e.aiOptimizeUpstreamId,[o.DRAWING_AI_OPTIMIZE_AIMODEL_ID]:e.aiOptimizeAimodelId,[o.DRAWING_AI_OPTIMIZE_MODEL_NAME]:e.aiOptimizeModelName,[o.DRAWING_EMBEDDED_UPSTREAM_ID]:e.embeddedUpstreamId,[o.DRAWING_EMBEDDED_AIMODEL_ID]:e.embeddedAimodelId,[o.DRAWING_WORKBENCH_UPSTREAM_ID]:e.workbenchUpstreamId,[o.DRAWING_WORKBENCH_AIMODEL_ID]:e.workbenchAimodelId}),r.add({title:"设置已保存",color:"success"})}catch(a){r.add({title:"保存失败",description:a.message,color:"error"})}finally{v.value=!1}}async function h(){if(window.electronAPI?.selectFolder){u.value=!0;try{const a=await window.electronAPI.selectFolder();if(!a)return;e.imageSavePath=a,await f({[o.GENERAL_IMAGE_SAVE_PATH]:a}),r.add({title:"已保存",description:"重启应用后生效",color:"success"})}catch(a){r.add({title:"设置失败",description:a.message,color:"error"})}finally{u.value=!1}}}async function W(){if(window.electronAPI){u.value=!0;try{e.imageSavePath="",await f({[o.GENERAL_IMAGE_SAVE_PATH]:""}),r.add({title:"已重置",description:"重启应用后生效",color:"success"})}catch(a){r.add({title:"重置失败",description:a.message,color:"error"})}finally{u.value=!1}}}const U=m({get:()=>e.aiOptimizeUpstreamId||null,set:a=>{e.aiOptimizeUpstreamId=a||0}}),D=m({get:()=>e.aiOptimizeAimodelId||null,set:a=>{if(e.aiOptimizeAimodelId=a||0,a&&e.aiOptimizeUpstreamId){const c=A.value.find(x=>x.id===e.aiOptimizeUpstreamId)?.aimodels?.find(x=>x.id===a);e.aiOptimizeModelName=c?.modelName||""}else e.aiOptimizeModelName=""}}),N=m({get:()=>e.embeddedUpstreamId||null,set:a=>{e.embeddedUpstreamId=a||0}}),w=m({get:()=>e.embeddedAimodelId||null,set:a=>{e.embeddedAimodelId=a||0}}),M=m({get:()=>e.workbenchUpstreamId||null,set:a=>{e.workbenchUpstreamId=a||0}}),y=m({get:()=>e.workbenchAimodelId||null,set:a=>{e.workbenchAimodelId=a||0}});return(a,t)=>{const c=X,x=q,K=J,O=Q,S=ee,j=te;return p(),Y(j,null,{default:b(()=>[s("div",oe,[t[11]||(t[11]=s("h2",{class:"text-lg font-medium text-(--ui-text)"},"通用设置",-1)),n(c,{loading:i(v),onClick:V},{default:b(()=>[...t[10]||(t[10]=[_("保存",-1)])]),_:1},8,["loading"])]),i(T)?(p(),E("div",ae,[n(x,{name:"i-heroicons-arrow-path",class:"w-8 h-8 text-(--ui-text-dimmed) animate-spin"})])):(p(),E("div",le,[s("div",de,[t[16]||(t[16]=s("h3",{class:"text-base font-medium text-(--ui-text) mb-4"},"绘图",-1)),s("div",ne,[s("label",me,[t[12]||(t[12]=s("div",null,[s("span",{class:"text-(--ui-text)"},"生图默认模糊"),s("p",{class:"text-xs text-(--ui-text-muted) mt-1"},"新生成的图片默认显示模糊效果")],-1)),n(K,{modelValue:i(e).blurByDefault,"onUpdate:modelValue":t[0]||(t[0]=l=>i(e).blurByDefault=l)},null,8,["modelValue"])]),s("div",re,[t[13]||(t[13]=s("div",null,[s("span",{class:"text-(--ui-text)"},"AI 优化提示词模型"),s("p",{class:"text-xs text-(--ui-text-muted) mt-1"},"用于优化绘图提示词的对话模型")],-1)),n(O,{upstreams:i(A),category:"chat","list-layout":"","no-auto-select":"","align-right":"","upstream-id":i(U),"onUpdate:upstreamId":t[1]||(t[1]=l=>I(U)?U.value=l:null),"aimodel-id":i(D),"onUpdate:aimodelId":t[2]||(t[2]=l=>I(D)?D.value=l:null)},null,8,["upstreams","upstream-id","aimodel-id"])]),s("div",ue,[t[14]||(t[14]=s("div",null,[s("span",{class:"text-(--ui-text)"},"嵌入式绘画默认模型"),s("p",{class:"text-xs text-(--ui-text-muted) mt-1"},"对话中嵌入式绘画的默认模型")],-1)),n(O,{upstreams:i(A),category:"image","show-type-label":"","no-auto-select":"","align-right":"","upstream-id":i(N),"onUpdate:upstreamId":t[3]||(t[3]=l=>I(N)?N.value=l:null),"aimodel-id":i(w),"onUpdate:aimodelId":t[4]||(t[4]=l=>I(w)?w.value=l:null)},null,8,["upstreams","upstream-id","aimodel-id"])]),s("div",pe,[t[15]||(t[15]=s("div",null,[s("span",{class:"text-(--ui-text)"},"工作台默认模型"),s("p",{class:"text-xs text-(--ui-text-muted) mt-1"},"绘图工作台的默认选择")],-1)),n(O,{upstreams:i(A),category:"image","show-type-label":"","no-auto-select":"","align-right":"","upstream-id":i(M),"onUpdate:upstreamId":t[5]||(t[5]=l=>I(M)?M.value=l:null),"aimodel-id":i(y),"onUpdate:aimodelId":t[6]||(t[6]=l=>I(y)?y.value=l:null)},null,8,["upstreams","upstream-id","aimodel-id"])])])]),s("div",_e,[t[21]||(t[21]=s("h3",{class:"text-base font-medium text-(--ui-text) mb-4"},"存储",-1)),s("div",Ie,[s("div",ce,[s("div",xe,[t[17]||(t[17]=s("span",{class:"text-(--ui-text)"},"图片保存路径",-1)),s("p",Ee,[i(e).imageSavePath?(p(),E(P,{key:0},[_(L(i(e).imageSavePath),1)],64)):i(g)?.uploads?(p(),E(P,{key:1},[_(L(i(g).uploads)+"（默认） ",1)],64)):(p(),E(P,{key:2},[_(" （默认） ")],64))])]),s("div",Ae,[n(c,{size:"xs",variant:"outline",loading:i(u),disabled:!i(G),onClick:h},{default:b(()=>[...t[18]||(t[18]=[_(" 选择路径 ",-1)])]),_:1},8,["loading","disabled"]),n(c,{size:"xs",variant:"outline",color:"neutral",loading:i(u),disabled:!i(G)||!i(e).imageSavePath,onClick:W},{default:b(()=>[...t[19]||(t[19]=[_(" 重置 ",-1)])]),_:1},8,["loading","disabled"])])]),t[20]||(t[20]=s("p",{class:"text-xs text-(--ui-text-muted)"}," 修改后需重启应用生效 ",-1))])]),s("div",ge,[t[25]||(t[25]=s("h3",{class:"font-medium text-(--ui-text) mb-4"},"对话",-1)),s("div",be,[s("div",fe,[t[22]||(t[22]=s("div",null,[s("span",{class:"text-(--ui-text)"},"压缩保留消息数"),s("p",{class:"text-xs text-(--ui-text-muted) mt-1"},"压缩时保留最近的消息条数")],-1)),n(S,{modelValue:i(e).compressKeepCount,"onUpdate:modelValue":t[7]||(t[7]=l=>i(e).compressKeepCount=l),modelModifiers:{number:!0},type:"number",min:"2",max:"10",class:"w-20"},null,8,["modelValue"])]),s("div",ve,[t[23]||(t[23]=s("div",null,[s("span",{class:"text-(--ui-text)"},"标题最大长度"),s("p",{class:"text-xs text-(--ui-text-muted) mt-1"},"自动生成标题的最大字符数")],-1)),n(S,{modelValue:i(e).titleMaxLength,"onUpdate:modelValue":t[8]||(t[8]=l=>i(e).titleMaxLength=l),modelModifiers:{number:!0},type:"number",min:"10",max:"50",class:"w-20"},null,8,["modelValue"])]),s("div",Ue,[t[24]||(t[24]=s("div",null,[s("span",{class:"text-(--ui-text)"},"开场白建议数量"),s("p",{class:"text-xs text-(--ui-text-muted) mt-1"},"新对话时生成的建议条数")],-1)),n(S,{modelValue:i(e).suggestionsCount,"onUpdate:modelValue":t[9]||(t[9]=l=>i(e).suggestionsCount=l),modelModifiers:{number:!0},type:"number",min:"3",max:"10",class:"w-20"},null,8,["modelValue"])])])])]))]),_:1})}}});export{he as default};
