import{f as R,B as j,R as S,m as p,O as P,q as z,c as x,a as t,b as o,h as E,j as s,w as r,t as G,z as L,o as v,k as O,d as g,U as q}from"./DZ_1_TWT.js";import{_ as J}from"./BsBDnP6U.js";import{_ as H}from"./BOxYQfEP.js";import{_ as K}from"./GNaDb_Wx.js";import"./uQ15kqef.js";import"./DDAgXY8S.js";import"./2BvrFYEm.js";import"./CHEUhdok.js";const Q={class:"p-6"},W={class:"max-w-2xl mx-auto"},X={key:0,class:"text-center py-12"},Y={key:1,class:"space-y-6"},Z={class:"bg-(--ui-bg-elevated) rounded-lg p-6 border border-(--ui-border) space-y-5"},ee={class:"flex items-center gap-4"},te={class:"relative w-20 h-20 rounded-full overflow-hidden group"},ae=["src"],se={key:1,class:"w-full h-full border-2 border-dashed border-(--ui-border-accented) hover:border-(--ui-primary) transition-colors flex flex-col items-center justify-center cursor-pointer rounded-full bg-(--ui-bg-muted)"},oe={class:"flex justify-end"},le={class:"bg-(--ui-bg-elevated) rounded-lg p-6 border border-(--ui-border) space-y-5"},re={class:"text-sm text-(--ui-text-muted)"},de={class:"flex justify-end"},ne={class:"bg-(--ui-bg-elevated) rounded-lg p-6 border border-(--ui-border) space-y-5"},ie={class:"flex justify-end"},ue={class:"bg-(--ui-bg-elevated) rounded-lg p-6 border border-red-500/30 space-y-5"},me={class:"flex justify-end"},ce={class:"space-y-4"},fe={class:"flex justify-end gap-2"},he=R({__name:"user",setup(pe){const{updateUser:$}=j(),d=S(),b=p(!0),h=p(!1),V=p(""),i=P({name:"",avatar:""}),l=P({currentPassword:"",newPassword:"",confirmPassword:""}),U=p(!1),m=P({newEmail:"",password:""}),k=p(!1);async function A(){b.value=!0;try{const a=await $fetch("/api/user");i.name=a.name||"",i.avatar=a.avatar||"",V.value=a.email||""}catch(a){d.add({title:"加载失败",description:a.data?.message||a.message,color:"error"})}finally{b.value=!1}}z(()=>{A()});async function B(a){const c=a.target.files?.[0];if(!c)return;if(c.size>2*1024*1024){d.add({title:"图片大小不能超过 2MB",color:"error"});return}const u=new FileReader;u.onload=()=>{i.avatar=u.result},u.readAsDataURL(c)}function T(){i.avatar=""}async function D(){h.value=!0;try{await $fetch("/api/user",{method:"PUT",body:{name:i.name?.trim()||null,avatar:i.avatar||null}}),$({name:i.name?.trim()||null,avatar:i.avatar||null}),d.add({title:"个人信息已保存",color:"success"})}catch(a){d.add({title:"保存失败",description:a.data?.message||a.message,color:"error"})}finally{h.value=!1}}async function F(){if(!l.currentPassword||!l.newPassword){d.add({title:"请填写当前密码和新密码",color:"error"});return}if(l.newPassword.length<6){d.add({title:"新密码长度不能少于6位",color:"error"});return}if(l.newPassword!==l.confirmPassword){d.add({title:"两次输入的新密码不一致",color:"error"});return}U.value=!0;try{await $fetch("/api/user/password",{method:"PUT",body:{currentPassword:l.currentPassword,newPassword:l.newPassword}}),d.add({title:"密码修改成功",color:"success"}),l.currentPassword="",l.newPassword="",l.confirmPassword=""}catch(a){d.add({title:"修改失败",description:a.data?.message||a.message,color:"error"})}finally{U.value=!1}}async function N(){if(!m.newEmail||!m.password){d.add({title:"请填写新邮箱和密码",color:"error"});return}k.value=!0;try{const a=await $fetch("/api/user/email",{method:"PUT",body:{newEmail:m.newEmail,password:m.password}});$({email:a.email}),V.value=a.email,d.add({title:"邮箱修改成功",color:"success"}),m.newEmail="",m.password=""}catch(a){d.add({title:"修改失败",description:a.data?.message||a.message,color:"error"})}finally{k.value=!1}}const y=P({password:""}),C=p(!1),_=p(!1);async function M(){if(!y.password){d.add({title:"请输入密码确认删除",color:"error"});return}C.value=!0;try{await $fetch("/api/user/delete",{method:"POST",body:{password:y.password}}),d.add({title:"账号已删除",color:"success"}),_.value=!1;const{logout:a}=j();a(),q("/login")}catch(a){d.add({title:"删除失败",description:a.data?.message||a.message,color:"error"})}finally{C.value=!1}}return(a,e)=>{const c=O,u=J,f=H,w=L,I=K;return v(),x("div",Q,[t("div",W,[e[19]||(e[19]=t("div",{class:"mb-6"},[t("h1",{class:"text-2xl font-bold text-(--ui-text)"},"用户设置"),t("p",{class:"text-(--ui-text-muted) text-sm mt-1"},"管理你的个人信息和偏好设置")],-1)),s(b)?(v(),x("div",X,[o(c,{name:"i-heroicons-arrow-path",class:"w-8 h-8 text-(--ui-text-dimmed) animate-spin"})])):E("",!0),s(b)?E("",!0):(v(),x("div",Y,[t("div",Z,[e[11]||(e[11]=t("h2",{class:"text-lg font-medium text-(--ui-text)"},"个人信息",-1)),o(u,{label:"头像",name:"avatar"},{default:r(()=>[t("div",ee,[t("div",te,[s(i).avatar?(v(),x("img",{key:0,src:s(i).avatar,class:"w-full h-full object-cover"},null,8,ae)):(v(),x("label",se,[o(c,{name:"i-heroicons-user",class:"w-8 h-8 text-(--ui-text-dimmed)"}),t("input",{type:"file",accept:"image/*",class:"hidden",onChange:B},null,32)])),s(i).avatar?(v(),x("button",{key:2,type:"button",class:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center rounded-full",onClick:T},[o(c,{name:"i-heroicons-x-mark",class:"w-6 h-6 text-white"})])):E("",!0)]),e[9]||(e[9]=t("div",{class:"text-sm text-(--ui-text-muted)"},[t("p",null,"点击上传头像"),t("p",{class:"text-xs"},"支持 JPG、PNG，最大 2MB")],-1))])]),_:1}),o(u,{label:"昵称",name:"name"},{default:r(()=>[o(f,{modelValue:s(i).name,"onUpdate:modelValue":e[0]||(e[0]=n=>s(i).name=n),placeholder:"输入你的昵称",class:"w-full max-w-xs"},null,8,["modelValue"])]),_:1}),t("div",oe,[o(w,{loading:s(h),onClick:D},{default:r(()=>[...e[10]||(e[10]=[g(" 保存 ",-1)])]),_:1},8,["loading"])])]),t("div",le,[e[13]||(e[13]=t("h2",{class:"text-lg font-medium text-(--ui-text)"},"修改邮箱",-1)),t("p",re,"当前邮箱："+G(s(V)),1),o(u,{label:"新邮箱",name:"newEmail"},{default:r(()=>[o(f,{modelValue:s(m).newEmail,"onUpdate:modelValue":e[1]||(e[1]=n=>s(m).newEmail=n),type:"email",placeholder:"输入新邮箱地址",class:"w-full max-w-xs"},null,8,["modelValue"])]),_:1}),o(u,{label:"确认密码",name:"emailPassword"},{default:r(()=>[o(f,{modelValue:s(m).password,"onUpdate:modelValue":e[2]||(e[2]=n=>s(m).password=n),type:"password",placeholder:"输入当前密码以确认身份",class:"w-full max-w-xs"},null,8,["modelValue"])]),_:1}),t("div",de,[o(w,{loading:s(k),onClick:N},{default:r(()=>[...e[12]||(e[12]=[g(" 修改邮箱 ",-1)])]),_:1},8,["loading"])])]),t("div",ne,[e[15]||(e[15]=t("h2",{class:"text-lg font-medium text-(--ui-text)"},"修改密码",-1)),o(u,{label:"当前密码",name:"currentPassword"},{default:r(()=>[o(f,{modelValue:s(l).currentPassword,"onUpdate:modelValue":e[3]||(e[3]=n=>s(l).currentPassword=n),type:"password",placeholder:"输入当前密码",class:"w-full max-w-xs"},null,8,["modelValue"])]),_:1}),o(u,{label:"新密码",name:"newPassword"},{default:r(()=>[o(f,{modelValue:s(l).newPassword,"onUpdate:modelValue":e[4]||(e[4]=n=>s(l).newPassword=n),type:"password",placeholder:"输入新密码（至少6位）",class:"w-full max-w-xs"},null,8,["modelValue"])]),_:1}),o(u,{label:"确认新密码",name:"confirmPassword"},{default:r(()=>[o(f,{modelValue:s(l).confirmPassword,"onUpdate:modelValue":e[5]||(e[5]=n=>s(l).confirmPassword=n),type:"password",placeholder:"再次输入新密码",class:"w-full max-w-xs"},null,8,["modelValue"])]),_:1}),t("div",ie,[o(w,{loading:s(U),onClick:F},{default:r(()=>[...e[14]||(e[14]=[g(" 修改密码 ",-1)])]),_:1},8,["loading"])])]),t("div",ue,[e[17]||(e[17]=t("h2",{class:"text-lg font-medium text-red-500"},"危险区域",-1)),e[18]||(e[18]=t("p",{class:"text-sm text-(--ui-text-muted)"}," 删除账号将永久删除你的所有数据，包括上游配置、AI 模型、绘图任务、助手、对话记录等。此操作不可撤销。 ",-1)),t("div",me,[o(w,{color:"error",variant:"outline",onClick:e[6]||(e[6]=n=>_.value=!0)},{default:r(()=>[...e[16]||(e[16]=[g(" 删除账号 ",-1)])]),_:1})])])]))]),o(I,{open:s(_),title:"确认删除账号",close:!1},{body:r(()=>[t("div",ce,[e[20]||(e[20]=t("p",{class:"text-(--ui-text-muted)"}," 你确定要删除账号吗？此操作将永久删除你的所有数据，且无法恢复。 ",-1)),o(u,{label:"输入密码确认",name:"deletePassword"},{default:r(()=>[o(f,{modelValue:s(y).password,"onUpdate:modelValue":e[7]||(e[7]=n=>s(y).password=n),type:"password",placeholder:"输入密码",class:"w-full"},null,8,["modelValue"])]),_:1})])]),footer:r(()=>[t("div",fe,[o(w,{variant:"ghost",onClick:e[8]||(e[8]=n=>{_.value=!1,s(y).password=""})},{default:r(()=>[...e[21]||(e[21]=[g(" 取消 ",-1)])]),_:1}),o(w,{color:"error",loading:s(C),onClick:M},{default:r(()=>[...e[22]||(e[22]=[g(" 确认删除 ",-1)])]),_:1},8,["loading"])])]),_:1},8,["open"])])}}});export{he as default};
