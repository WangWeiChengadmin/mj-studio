import{a3 as W,ac as st,J as E,g as O,K as B,i as C,o as s,w as c,N as k,a as e,c as n,h as f,ad as ot,a0 as V,k as K,n as y,d as S,t as w,F as N,r as T,z as D,j as d,P as H,f as at,R as it,S as rt,m as b,q as nt,b as l,y as F,H as lt}from"./DZ_1_TWT.js";import{_ as ct}from"./Ds9Pl6UP.js";import{_ as dt}from"./BOxYQfEP.js";import{_ as ut}from"./BsBDnP6U.js";import{_ as mt}from"./GNaDb_Wx.js";import"./9BQeByXX.js";import"./D41R7u62.js";import"./CHEUhdok.js";import"./DDAgXY8S.js";import"./uQ15kqef.js";import"./2BvrFYEm.js";const ft={slots:{root:"relative overflow-hidden w-full rounded-lg p-4 flex gap-2.5",wrapper:"min-w-0 flex-1 flex flex-col",title:"text-sm font-medium",description:"text-sm opacity-90",icon:"shrink-0 size-5",avatar:"shrink-0",avatarSize:"2xl",actions:"flex flex-wrap gap-1.5 shrink-0",close:"p-0"},variants:{color:{primary:"",secondary:"",success:"",info:"",warning:"",error:"",neutral:""},variant:{solid:"",outline:"",soft:"",subtle:""},orientation:{horizontal:{root:"items-center",actions:"items-center"},vertical:{root:"items-start",actions:"items-start mt-2.5"}},title:{true:{description:"mt-1"}}},compoundVariants:[{color:"primary",variant:"solid",class:{root:"bg-primary text-inverted"}},{color:"secondary",variant:"solid",class:{root:"bg-secondary text-inverted"}},{color:"success",variant:"solid",class:{root:"bg-success text-inverted"}},{color:"info",variant:"solid",class:{root:"bg-info text-inverted"}},{color:"warning",variant:"solid",class:{root:"bg-warning text-inverted"}},{color:"error",variant:"solid",class:{root:"bg-error text-inverted"}},{color:"primary",variant:"outline",class:{root:"text-primary ring ring-inset ring-primary/25"}},{color:"secondary",variant:"outline",class:{root:"text-secondary ring ring-inset ring-secondary/25"}},{color:"success",variant:"outline",class:{root:"text-success ring ring-inset ring-success/25"}},{color:"info",variant:"outline",class:{root:"text-info ring ring-inset ring-info/25"}},{color:"warning",variant:"outline",class:{root:"text-warning ring ring-inset ring-warning/25"}},{color:"error",variant:"outline",class:{root:"text-error ring ring-inset ring-error/25"}},{color:"primary",variant:"soft",class:{root:"bg-primary/10 text-primary"}},{color:"secondary",variant:"soft",class:{root:"bg-secondary/10 text-secondary"}},{color:"success",variant:"soft",class:{root:"bg-success/10 text-success"}},{color:"info",variant:"soft",class:{root:"bg-info/10 text-info"}},{color:"warning",variant:"soft",class:{root:"bg-warning/10 text-warning"}},{color:"error",variant:"soft",class:{root:"bg-error/10 text-error"}},{color:"primary",variant:"subtle",class:{root:"bg-primary/10 text-primary ring ring-inset ring-primary/25"}},{color:"secondary",variant:"subtle",class:{root:"bg-secondary/10 text-secondary ring ring-inset ring-secondary/25"}},{color:"success",variant:"subtle",class:{root:"bg-success/10 text-success ring ring-inset ring-success/25"}},{color:"info",variant:"subtle",class:{root:"bg-info/10 text-info ring ring-inset ring-info/25"}},{color:"warning",variant:"subtle",class:{root:"bg-warning/10 text-warning ring ring-inset ring-warning/25"}},{color:"error",variant:"subtle",class:{root:"bg-error/10 text-error ring ring-inset ring-error/25"}},{color:"neutral",variant:"solid",class:{root:"text-inverted bg-inverted"}},{color:"neutral",variant:"outline",class:{root:"text-highlighted bg-default ring ring-inset ring-default"}},{color:"neutral",variant:"soft",class:{root:"text-highlighted bg-elevated/50"}},{color:"neutral",variant:"subtle",class:{root:"text-highlighted bg-elevated/50 ring ring-inset ring-accented"}}],defaultVariants:{color:"primary",variant:"solid"}},vt={__name:"UAlert",props:{as:{type:null,required:!1},title:{type:String,required:!1},description:{type:String,required:!1},icon:{type:null,required:!1},avatar:{type:Object,required:!1},color:{type:null,required:!1},variant:{type:null,required:!1},orientation:{type:null,required:!1,default:"vertical"},actions:{type:Array,required:!1},close:{type:[Boolean,Object],required:!1},closeIcon:{type:null,required:!1},class:{type:null,required:!1},ui:{type:null,required:!1}},emits:["update:open"],setup(a,{emit:u}){const i=a,$=u,m=W(),{t:p}=st(),j=E(),v=O(()=>B({extend:B(ft),...j.ui?.alert||{}})({color:i.color,variant:i.variant,orientation:i.orientation,title:!!i.title||!!m.title}));return(g,x)=>(s(),C(d(H),{as:a.as,"data-orientation":a.orientation,"data-slot":"root",class:y(v.value.root({class:[i.ui?.root,i.class]}))},{default:c(()=>[k(g.$slots,"leading",{ui:v.value},()=>[a.avatar?(s(),C(ot,V({key:0,size:i.ui?.avatarSize||v.value.avatarSize()},a.avatar,{"data-slot":"avatar",class:v.value.avatar({class:i.ui?.avatar})}),null,16,["size","class"])):a.icon?(s(),C(K,{key:1,name:a.icon,"data-slot":"icon",class:y(v.value.icon({class:i.ui?.icon}))},null,8,["name","class"])):f("",!0)]),e("div",{"data-slot":"wrapper",class:y(v.value.wrapper({class:i.ui?.wrapper}))},[a.title||m.title?(s(),n("div",{key:0,"data-slot":"title",class:y(v.value.title({class:i.ui?.title}))},[k(g.$slots,"title",{},()=>[S(w(a.title),1)])],2)):f("",!0),a.description||m.description?(s(),n("div",{key:1,"data-slot":"description",class:y(v.value.description({class:i.ui?.description}))},[k(g.$slots,"description",{},()=>[S(w(a.description),1)])],2)):f("",!0),a.orientation==="vertical"&&(a.actions?.length||m.actions)?(s(),n("div",{key:2,"data-slot":"actions",class:y(v.value.actions({class:i.ui?.actions}))},[k(g.$slots,"actions",{},()=>[(s(!0),n(N,null,T(a.actions,(_,h)=>(s(),C(D,V({key:h,size:"xs"},{ref_for:!0},_),null,16))),128))])],2)):f("",!0)],2),a.orientation==="horizontal"&&(a.actions?.length||m.actions)||a.close?(s(),n("div",{key:0,"data-slot":"actions",class:y(v.value.actions({class:i.ui?.actions,orientation:"horizontal"}))},[a.orientation==="horizontal"&&(a.actions?.length||m.actions)?k(g.$slots,"actions",{key:0},()=>[(s(!0),n(N,null,T(a.actions,(_,h)=>(s(),C(D,V({key:h,size:"xs"},{ref_for:!0},_),null,16))),128))]):f("",!0),k(g.$slots,"close",{ui:v.value},()=>[a.close?(s(),C(D,V({key:0,icon:a.closeIcon||d(j).ui.icons.close,color:"neutral",variant:"link","aria-label":d(p)("alert.close")},typeof a.close=="object"?a.close:{},{"data-slot":"close",class:v.value.close({class:i.ui?.close}),onClick:x[0]||(x[0]=_=>$("update:open",!1))}),null,16,["icon","aria-label","class"])):f("",!0)])],2)):f("",!0)]),_:3},8,["as","data-orientation","class"]))}},gt={slots:{root:"rounded-lg overflow-hidden",header:"p-4 sm:px-6",body:"p-4 sm:p-6",footer:"p-4 sm:px-6"},variants:{variant:{solid:{root:"bg-inverted text-inverted"},outline:{root:"bg-default ring ring-default divide-y divide-default"},soft:{root:"bg-elevated/50 divide-y divide-default"},subtle:{root:"bg-elevated/50 ring ring-default divide-y divide-default"}}},defaultVariants:{variant:"outline"}},pt={__name:"UCard",props:{as:{type:null,required:!1},variant:{type:null,required:!1},class:{type:null,required:!1},ui:{type:null,required:!1}},setup(a){const u=a,i=W(),$=E(),m=O(()=>B({extend:B(gt),...$.ui?.card||{}})({variant:u.variant}));return(p,j)=>(s(),C(d(H),{as:a.as,"data-slot":"root",class:y(m.value.root({class:[u.ui?.root,u.class]}))},{default:c(()=>[i.header?(s(),n("div",{key:0,"data-slot":"header",class:y(m.value.header({class:u.ui?.header}))},[k(p.$slots,"header")],2)):f("",!0),i.default?(s(),n("div",{key:1,"data-slot":"body",class:y(m.value.body({class:u.ui?.body}))},[k(p.$slots,"default")],2)):f("",!0),i.footer?(s(),n("div",{key:2,"data-slot":"footer",class:y(m.value.footer({class:u.ui?.footer}))},[k(p.$slots,"footer")],2)):f("",!0)]),_:3},8,["as","class"]))}},yt={class:"max-w-6xl mx-auto px-6 py-8"},xt={class:"flex items-center justify-between mb-8"},ht={key:0,class:"flex items-center justify-center py-20"},bt={key:1,class:"mb-8"},wt={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},kt=["onClick"],$t={class:"flex items-start gap-3"},_t={class:"w-10 h-10 rounded-lg bg-(--ui-bg-accented) flex items-center justify-center flex-shrink-0"},Ct={class:"flex-1 min-w-0"},qt={class:"font-medium text-(--ui-text) truncate"},zt={class:"text-sm text-(--ui-text-muted) mt-0.5 line-clamp-2"},St={class:"flex items-center gap-2 mt-2 text-xs text-(--ui-text-dimmed)"},jt={key:0,class:"px-1.5 py-0.5 rounded bg-(--ui-bg-accented)"},Ut={key:2},Vt={key:0,class:"text-center py-16 border border-dashed border-(--ui-border) rounded-lg"},Dt={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},Bt=["onClick"],Nt=["src"],Tt={class:"p-4"},At={class:"flex items-start justify-between"},Pt=["onClick"],Ft={class:"font-medium text-(--ui-text) truncate"},It={key:0,class:"text-sm text-(--ui-text-muted) mt-0.5 line-clamp-1"},Lt={class:"text-xs text-(--ui-text-dimmed) mt-2"},Mt={class:"flex items-center justify-between"},Rt={class:"space-y-4"},Wt={class:"flex justify-end gap-2"},Et={class:"text-(--ui-text-muted)"},Ot={class:"flex justify-end gap-2"},oe=at({__name:"workflows",setup(a){const u=it(),i=rt(),$=b([]),m=b([]),p=b(!0);async function j(){p.value=!0;try{const[r,t]=await Promise.all([$fetch("/api/workflows"),$fetch("/api/workflow-templates")]);$.value=r.data||[],m.value=t.data||[]}catch(r){console.error("加载数据失败:",r)}finally{p.value=!1}}async function v(){try{const r=await $fetch("/api/workflows");$.value=r.data||[]}catch(r){console.error("刷新失败:",r)}}nt(()=>{j()});const g=b(!1),x=b(""),_=b(!1),h=b(!1),U=b(null),A=b(!1);async function I(){if(!x.value.trim()){u.add({title:"请输入工作流名称",color:"error"});return}_.value=!0;try{const r=await $fetch("/api/workflows",{method:"POST",body:{name:x.value.trim(),data:{version:"1.0.0",name:x.value.trim(),nodes:[],edges:[],viewport:{x:0,y:0,zoom:1}}}});r.success&&(u.add({title:"工作流已创建",color:"success"}),g.value=!1,x.value="",i.push(`/workflow/${r.data.id}`))}catch(r){u.add({title:"创建失败",description:r.data?.message,color:"error"})}finally{_.value=!1}}async function J(r){try{const t=await $fetch(`/api/workflow-templates/${r.id}/use`,{method:"POST"});t.success&&(u.add({title:"工作流已创建",color:"success"}),i.push(`/workflow/${t.data.id}`))}catch(t){u.add({title:"创建失败",description:t.data?.message,color:"error"})}}function P(r){i.push(`/workflow/${r.id}`)}function G(r){U.value=r,h.value=!0}async function Q(){if(U.value){A.value=!0;try{await $fetch(`/api/workflows/${U.value.id}`,{method:"DELETE"}),u.add({title:"工作流已删除",color:"success"}),h.value=!1,U.value=null,await v()}catch(r){u.add({title:"删除失败",description:r.data?.message,color:"error"})}finally{A.value=!1}}}function X(r){return new Date(r).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}return(r,t)=>{const Y=vt,q=K,z=D,Z=ct,tt=dt,et=ut,L=pt,M=mt;return s(),n("div",yt,[l(Y,{class:"mb-6",color:"warning",variant:"subtle",icon:"i-heroicons-exclamation-triangle",title:"功能预览",description:"工作流功能处于预览阶段，暂停开发中。如有好的想法或建议，欢迎反馈！"}),e("div",xt,[t[8]||(t[8]=e("div",null,[e("h1",{class:"text-2xl font-bold text-(--ui-text)"},"工作流"),e("p",{class:"text-(--ui-text-muted) mt-1"},"管理你的 AI 工作流")],-1)),l(z,{color:"primary",onClick:t[0]||(t[0]=o=>g.value=!0)},{default:c(()=>[l(q,{name:"i-heroicons-plus",class:"w-4 h-4 mr-1"}),t[7]||(t[7]=S(" 新建工作流 ",-1))]),_:1})]),d(p)?(s(),n("div",ht,[l(q,{name:"i-heroicons-arrow-path",class:"w-6 h-6 animate-spin text-(--ui-text-muted)"})])):f("",!0),!d(p)&&d(m).length>0?(s(),n("div",bt,[t[9]||(t[9]=e("h2",{class:"text-lg font-medium text-(--ui-text) mb-4"},"从模板开始",-1)),e("div",wt,[(s(!0),n(N,null,T(d(m),o=>(s(),n("div",{key:o.id,class:"border border-(--ui-border) rounded-lg p-4 hover:border-(--ui-primary) cursor-pointer transition-colors bg-(--ui-bg-elevated)",onClick:R=>J(o)},[e("div",$t,[e("div",_t,[l(q,{name:o.category==="video"?"i-heroicons-film":"i-heroicons-photo",class:"w-5 h-5 text-(--ui-primary)"},null,8,["name"])]),e("div",Ct,[e("h3",qt,w(o.name),1),e("p",zt,w(o.description),1),e("div",St,[o.isBuiltin?(s(),n("span",jt,"内置")):f("",!0),e("span",null,w(o.usageCount)+" 次使用",1)])])])],8,kt))),128))])])):f("",!0),d(p)?f("",!0):(s(),n("div",Ut,[t[12]||(t[12]=e("h2",{class:"text-lg font-medium text-(--ui-text) mb-4"},"我的工作流",-1)),d($).length===0?(s(),n("div",Vt,[l(q,{name:"i-heroicons-square-3-stack-3d",class:"w-12 h-12 text-(--ui-text-dimmed) mx-auto mb-3"}),t[10]||(t[10]=e("p",{class:"text-(--ui-text-muted)"},"还没有工作流",-1)),t[11]||(t[11]=e("p",{class:"text-sm text-(--ui-text-dimmed) mt-1"},"创建一个新工作流或从模板开始",-1))])):(s(),n("div",Dt,[(s(!0),n(N,null,T(d($),o=>(s(),n("div",{key:o.id,class:"border border-(--ui-border) rounded-lg overflow-hidden hover:border-(--ui-primary) transition-colors bg-(--ui-bg-elevated) group"},[e("div",{class:"h-32 bg-(--ui-bg-accented) flex items-center justify-center cursor-pointer",onClick:R=>P(o)},[o.thumbnail?(s(),n("img",{key:0,src:o.thumbnail,class:"w-full h-full object-cover"},null,8,Nt)):(s(),C(q,{key:1,name:"i-heroicons-square-3-stack-3d",class:"w-10 h-10 text-(--ui-text-dimmed)"}))],8,Bt),e("div",Tt,[e("div",At,[e("div",{class:"flex-1 min-w-0 cursor-pointer",onClick:R=>P(o)},[e("h3",Ft,w(o.name),1),o.description?(s(),n("p",It,w(o.description),1)):f("",!0),e("p",Lt," 更新于 "+w(X(o.updatedAt)),1)],8,Pt),l(Z,{items:[{label:"打开",icon:"i-heroicons-arrow-top-right-on-square",onSelect:()=>P(o)},{label:"删除",icon:"i-heroicons-trash",onSelect:()=>G(o)}]},{default:c(()=>[l(z,{variant:"ghost",size:"xs",class:"opacity-0 group-hover:opacity-100 transition-opacity"},{default:c(()=>[l(q,{name:"i-heroicons-ellipsis-vertical",class:"w-4 h-4"})]),_:1})]),_:1},8,["items"])])])]))),128))]))])),l(M,{open:d(g),"onUpdate:open":t[4]||(t[4]=o=>F(g)?g.value=o:null)},{content:c(()=>[l(L,null,{header:c(()=>[e("div",Mt,[t[13]||(t[13]=e("h3",{class:"text-lg font-medium"},"新建工作流",-1)),l(z,{variant:"ghost",size:"xs",onClick:t[1]||(t[1]=o=>g.value=!1)},{default:c(()=>[l(q,{name:"i-heroicons-x-mark",class:"w-5 h-5"})]),_:1})])]),footer:c(()=>[e("div",Wt,[l(z,{variant:"ghost",onClick:t[3]||(t[3]=o=>g.value=!1)},{default:c(()=>[...t[14]||(t[14]=[S("取消",-1)])]),_:1}),l(z,{color:"primary",loading:d(_),onClick:I},{default:c(()=>[...t[15]||(t[15]=[S(" 创建 ",-1)])]),_:1},8,["loading"])])]),default:c(()=>[e("div",Rt,[l(et,{label:"工作流名称"},{default:c(()=>[l(tt,{modelValue:d(x),"onUpdate:modelValue":t[2]||(t[2]=o=>F(x)?x.value=o:null),placeholder:"输入工作流名称",onKeyup:lt(I,["enter"])},null,8,["modelValue"])]),_:1})])]),_:1})]),_:1},8,["open"]),l(M,{open:d(h),"onUpdate:open":t[6]||(t[6]=o=>F(h)?h.value=o:null)},{content:c(()=>[l(L,null,{header:c(()=>[...t[16]||(t[16]=[e("h3",{class:"text-lg font-medium"},"确认删除",-1)])]),footer:c(()=>[e("div",Ot,[l(z,{variant:"ghost",onClick:t[5]||(t[5]=o=>h.value=!1)},{default:c(()=>[...t[17]||(t[17]=[S("取消",-1)])]),_:1}),l(z,{color:"error",loading:d(A),onClick:Q},{default:c(()=>[...t[18]||(t[18]=[S(" 删除 ",-1)])]),_:1},8,["loading"])])]),default:c(()=>[e("p",Et," 确定要删除工作流「"+w(d(U)?.name)+"」吗？此操作不可恢复。 ",1)]),_:1})]),_:1},8,["open"])])}}});export{oe as default};
