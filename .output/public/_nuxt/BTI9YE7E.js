import{f as G,R as H,m as A,q as Q,g as C,i as b,w as x,o as i,a as s,c,b as h,z as W,d as k,k as X,j as m,h as S,t as w,F as T,r as I,n as P}from"./DZ_1_TWT.js";import{_ as Y}from"./DujSY10F.js";import{_ as Z}from"./D7Wf_XuP.js";import{_ as ee}from"./Ptiozo9H.js";import{u as te}from"./Czb6vWdC.js";import{u as se}from"./CJsX1qrP.js";import"./DASMixbo.js";import"./BKT0n4s3.js";import"./CHEUhdok.js";import"./D41R7u62.js";import"./uQ15kqef.js";import"./DTXzf-yb.js";import"./2BvrFYEm.js";const ae={class:"mb-4 flex items-center justify-between"},oe={class:"flex gap-2"},ie={key:0,class:"text-center py-12"},ne={key:1,class:"space-y-6"},le={class:"bg-(--ui-bg-elevated) rounded-lg p-6 border border-(--ui-border)"},re={class:"flex items-center justify-between mb-3"},me={key:0,class:"text-center py-6 text-(--ui-text-muted) text-sm"},ce={key:1,class:"space-y-2"},de=["onClick"],ue={class:"w-8 h-8 rounded-full flex-shrink-0 overflow-hidden ring-1 ring-(--ui-border)"},pe=["src"],fe={class:"flex-1 min-w-0"},ve={class:"text-sm font-medium truncate"},ye={class:"text-xs text-(--ui-text-dimmed) truncate"},ge={class:"bg-(--ui-bg-elevated) rounded-lg p-4 border border-(--ui-border)"},he={class:"flex items-center justify-between mb-3"},xe={key:0,class:"text-center py-6 text-(--ui-text-muted) text-sm"},_e={key:1,class:"space-y-2"},be=["onClick"],ke={class:"flex-1 min-w-0"},we={class:"text-sm font-medium truncate"},Ue={class:"text-xs text-(--ui-text-dimmed) truncate"},Re=G({__name:"export",setup(Ae){const{assistants:g,loadAssistants:B,createAssistant:L}=te(),{upstreams:d,loadUpstreams:R,createUpstream:D}=se(),U=H(),N=A(!0),j=A(null),n=A(new Set),l=A(new Set);Q(async()=>{await Promise.all([B(),R()]),N.value=!1});const $=C(()=>g.value.length>0&&n.value.size===g.value.length);C(()=>n.value.size>0&&n.value.size<g.value.length);function F(o){n.value.has(o)?n.value.delete(o):n.value.add(o),n.value=new Set(n.value)}function O(){$.value?n.value=new Set:n.value=new Set(g.value.map(o=>o.id))}const z=C(()=>d.value.length>0&&l.value.size===d.value.length);C(()=>l.value.size>0&&l.value.size<d.value.length);function E(o){l.value.has(o)?l.value.delete(o):l.value.add(o),l.value=new Set(l.value)}function V(){z.value?l.value=new Set:l.value=new Set(d.value.map(o=>o.id))}function J(){const o=g.value.filter(e=>n.value.has(e.id)),a=d.value.filter(e=>l.value.has(e.id));if(o.length===0&&a.length===0){U.add({title:"请先选择要导出的项目",color:"warning"});return}const u={version:2,exportedAt:new Date().toISOString(),assistants:o.map(e=>({name:e.name,description:e.description,avatar:e.avatar,systemPrompt:e.systemPrompt,isDefault:e.isDefault})),upstreams:a.map(e=>({name:e.name,baseUrl:e.baseUrl,apiKey:e.apiKey,apiKeys:e.apiKeys,remark:e.remark,isDefault:e.isDefault,upstreamPlatform:e.upstreamPlatform,userApiKey:e.userApiKey,aimodels:e.aimodels?.map(t=>({category:t.category,modelType:t.modelType,apiFormat:t.apiFormat,modelName:t.modelName,estimatedTime:t.estimatedTime,keyName:t.keyName}))}))},p=new Blob([JSON.stringify(u,null,2)],{type:"application/json"}),r=URL.createObjectURL(p),f=document.createElement("a");f.href=r,f.download=`mj-studio-export-${new Date().toISOString().slice(0,10)}.json`,f.click(),URL.revokeObjectURL(r);const v=[];o.length>0&&v.push(`${o.length} 个助手`),a.length>0&&v.push(`${a.length} 个上游配置`),U.add({title:`已导出 ${v.join("、")}`,color:"success"})}function q(){j.value?.click()}async function M(o){const a=o.target,u=a.files?.[0];if(u){try{const p=await u.text(),r=JSON.parse(p);if(!r.version)throw new Error("无效的导入文件格式");let f=0,v=0;if(Array.isArray(r.assistants))for(const t of r.assistants)try{await L({name:t.name,description:t.description||void 0,avatar:t.avatar||void 0,systemPrompt:t.systemPrompt||void 0,isDefault:!1}),f++}catch(K){console.error("导入助手失败:",t.name,K)}if(Array.isArray(r.upstreams)){for(const t of r.upstreams)if(!(!t.name||!t.baseUrl||!t.apiKey||d.value.some(y=>y.name===t.name)))try{await D({name:t.name,baseUrl:t.baseUrl,apiKey:t.apiKey,apiKeys:t.apiKeys,aimodels:t.aimodels||[],remark:t.remark,isDefault:!1,upstreamPlatform:t.upstreamPlatform,userApiKey:t.userApiKey}),v++}catch(y){console.error("导入上游配置失败:",t.name,y)}}if(Array.isArray(r.modelConfigs)){for(const t of r.modelConfigs)if(!(!t.name||!t.baseUrl||!t.apiKey||d.value.some(y=>y.name===t.name)))try{const y=(t.modelTypeConfigs||[]).map(_=>({category:_.category||"image",modelType:_.modelType,apiFormat:_.apiFormat,modelName:_.modelName,estimatedTime:_.estimatedTime,keyName:_.keyName}));await D({name:t.name,baseUrl:t.baseUrl,apiKey:t.apiKey,aimodels:y,remark:t.remark,isDefault:!1}),v++}catch(y){console.error("导入模型配置失败:",t.name,y)}}const e=[];f>0&&e.push(`${f} 个助手`),v>0&&e.push(`${v} 个上游配置`),e.length>0?U.add({title:`成功导入 ${e.join("、")}`,color:"success"}):U.add({title:"没有导入任何数据",color:"warning"})}catch(p){U.add({title:"导入失败",description:p.message,color:"error"})}a.value=""}}return(o,a)=>{const u=X,p=W,r=Y,f=Z,v=ee;return i(),b(v,null,{default:x(()=>[s("div",ae,[a[2]||(a[2]=s("h2",{class:"text-lg font-medium text-(--ui-text)"},"导入/导出",-1)),s("div",oe,[h(p,{variant:"outline",onClick:q},{default:x(()=>[h(u,{name:"i-heroicons-arrow-up-tray",class:"w-4 h-4 mr-1"}),a[0]||(a[0]=k(" 导入 ",-1))]),_:1}),h(p,{onClick:J},{default:x(()=>[h(u,{name:"i-heroicons-arrow-down-tray",class:"w-4 h-4 mr-1"}),a[1]||(a[1]=k(" 导出选中 ",-1))]),_:1})]),s("input",{ref_key:"fileInputRef",ref:j,type:"file",accept:".json",class:"hidden",onChange:M},null,544)]),m(N)?(i(),c("div",ie,[h(u,{name:"i-heroicons-arrow-path",class:"w-8 h-8 text-(--ui-text-dimmed) animate-spin"})])):(i(),c("div",ne,[s("div",le,[s("div",re,[a[3]||(a[3]=s("h3",{class:"text-base font-medium text-(--ui-text)"},"助手",-1)),m(g).length>0?(i(),b(p,{key:0,size:"xs",variant:"ghost",onClick:O},{default:x(()=>[k(w(m($)?"取消全选":"全选"),1)]),_:1})):S("",!0)]),m(g).length===0?(i(),c("div",me," 暂无助手，可在对话页面创建 ")):(i(),c("div",ce,[(i(!0),c(T,null,I(m(g),e=>(i(),c("div",{key:e.id,class:P(["flex items-center gap-3 p-2 rounded-lg cursor-pointer transition-colors",m(n).has(e.id)?"bg-(--ui-primary)/10":"hover:bg-(--ui-bg)"]),onClick:t=>F(e.id)},[h(r,{"model-value":m(n).has(e.id)},null,8,["model-value"]),s("div",ue,[e.avatar?(i(),c("img",{key:0,src:e.avatar,class:"w-full h-full object-cover"},null,8,pe)):(i(),b(u,{key:1,name:"i-heroicons-user-circle",class:"w-full h-full text-(--ui-text-muted)"}))]),s("div",fe,[s("div",ve,w(e.name),1),s("div",ye,w(e.description||"无描述"),1)]),e.isDefault?(i(),b(f,{key:0,size:"xs",color:"primary",variant:"soft"},{default:x(()=>[...a[4]||(a[4]=[k("默认",-1)])]),_:1})):S("",!0)],10,de))),128))]))]),s("div",ge,[s("div",he,[a[5]||(a[5]=s("h3",{class:"font-medium text-(--ui-text)"},"上游配置",-1)),m(d).length>0?(i(),b(p,{key:0,size:"xs",variant:"ghost",onClick:V},{default:x(()=>[k(w(m(z)?"取消全选":"全选"),1)]),_:1})):S("",!0)]),m(d).length===0?(i(),c("div",xe," 暂无上游配置 ")):(i(),c("div",_e,[(i(!0),c(T,null,I(m(d),e=>(i(),c("div",{key:e.id,class:P(["flex items-center gap-3 p-2 rounded-lg cursor-pointer transition-colors",m(l).has(e.id)?"bg-(--ui-primary)/10":"hover:bg-(--ui-bg)"]),onClick:t=>E(e.id)},[h(r,{"model-value":m(l).has(e.id)},null,8,["model-value"]),h(u,{name:"i-heroicons-cpu-chip",class:"w-5 h-5 text-(--ui-text-muted)"}),s("div",ke,[s("div",we,w(e.name),1),s("div",Ue,w(e.baseUrl),1)]),e.isDefault?(i(),b(f,{key:0,size:"xs",color:"primary",variant:"soft"},{default:x(()=>[...a[6]||(a[6]=[k("默认",-1)])]),_:1})):S("",!0)],10,be))),128))]))])])),a[7]||(a[7]=s("div",{class:"mt-6 p-4 bg-(--ui-bg-elevated) rounded-lg border border-(--ui-border)"},[s("h3",{class:"text-sm font-medium text-(--ui-text) mb-2"},"说明"),s("ul",{class:"text-xs text-(--ui-text-muted) space-y-1"},[s("li",null,'• 选择要导出的项目后点击"导出选中"'),s("li",null,"• 助手导出包含名称、描述、头像（Base64）和系统提示词"),s("li",null,"• 上游配置导出包含名称、API 地址、密钥和模型列表"),s("li",null,"• 导入时会创建新项目，同名上游配置会跳过"),s("li",null,"• 支持导入旧版本（v1）的配置文件")])],-1))]),_:1})}}});export{Re as default};
